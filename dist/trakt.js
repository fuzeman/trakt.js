!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.trakt=e()}(this,function(){var t,e,n;if(function(r){function o(t,e){return w.call(t,e)}function i(t,e){var n,r,o,i,u,s,a,c,f,l,p,d=e&&e.split("/"),h=g.map,y=h&&h["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=t.split("/"),u=t.length-1,g.nodeIdCompat&&T.test(t[u])&&(t[u]=t[u].replace(T,"")),t=d.concat(t),f=0;f<t.length;f+=1)if(p=t[f],"."===p)t.splice(f,1),f-=1;else if(".."===p){if(1===f&&(".."===t[2]||".."===t[0]))break;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||y)&&h){for(n=t.split("/"),f=n.length;f>0;f-=1){if(r=n.slice(0,f).join("/"),d)for(l=d.length;l>0;l-=1)if(o=h[d.slice(0,l).join("/")],o&&(o=o[r])){i=o,s=f;break}if(i)break;!a&&y&&y[r]&&(a=y[r],c=f)}!i&&a&&(i=a,s=c),i&&(n.splice(0,s,i),t=n.join("/"))}return t}function u(t,e){return function(){return d.apply(r,_.call(arguments,0).concat([t,e]))}}function s(t){return function(e){return i(e,t)}}function a(t){return function(e){v[t]=e}}function c(t){if(o(m,t)){var e=m[t];delete m[t],b[t]=!0,p.apply(r,e)}if(!o(v,t)&&!o(b,t))throw new Error("No "+t);return v[t]}function f(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function l(t){return function(){return g&&g.config&&g.config[t]||{}}}var p,d,h,y,v={},m={},g={},b={},w=Object.prototype.hasOwnProperty,_=[].slice,T=/\.js$/;h=function(t,e){var n,r=f(t),o=r[0];return t=r[1],o&&(o=i(o,e),n=c(o)),o?t=n&&n.normalize?n.normalize(t,s(e)):i(t,e):(t=i(t,e),r=f(t),o=r[0],t=r[1],o&&(n=c(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},y={require:function(t){return u(t)},exports:function(t){var e=v[t];return"undefined"!=typeof e?e:v[t]={}},module:function(t){return{id:t,uri:"",exports:v[t],config:l(t)}}},p=function(t,e,n,i){var s,f,l,p,d,g,w=[],_=typeof n;if(i=i||t,"undefined"===_||"function"===_){for(e=!e.length&&n.length?["require","exports","module"]:e,d=0;d<e.length;d+=1)if(p=h(e[d],i),f=p.f,"require"===f)w[d]=y.require(t);else if("exports"===f)w[d]=y.exports(t),g=!0;else if("module"===f)s=w[d]=y.module(t);else if(o(v,f)||o(m,f)||o(b,f))w[d]=c(f);else{if(!p.p)throw new Error(t+" missing "+f);p.p.load(p.n,u(i,!0),a(f),{}),w[d]=v[f]}l=n?n.apply(v[t],w):void 0,t&&(s&&s.exports!==r&&s.exports!==v[t]?v[t]=s.exports:l===r&&g||(v[t]=l))}else t&&(v[t]=n)},t=e=d=function(t,e,n,o,i){if("string"==typeof t)return y[t]?y[t](e):c(h(t,e).f);if(!t.splice){if(g=t,g.deps&&d(g.deps,g.callback),!e)return;e.splice?(t=e,e=n,n=null):t=r}return e=e||function(){},"function"==typeof n&&(n=o,o=i),o?p(r,t,e,n):setTimeout(function(){p(r,t,e,n)},4),d},d.config=function(t){return d(t)},t._defined=v,n=function(t,e,n){e.splice||(n=e,e=[]),o(v,t)||o(m,t)||(m[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),"undefined"!=typeof process&&"undefined"!=typeof process.versions&&"undefined"!=typeof process.versions.node){var r,o=e("url").parse,i=e("zlib"),u={http:e("http"),https:e("https")},s=0,a=1,c=2,f=function(t,e){t&&t.then?t.then(function(){e[s].apply(null,arguments)},function(){e[a].apply(null,arguments)},function(){e[c].apply(null,arguments)}):e[s](t)},l=global.process&&global.process.nextTick||global.setImmediate||global.setTimeout,p=function(t){var e,n=[],r=c,o=function(o){t[o]=function(){var t,i;if(n){for(e=[].slice.call(arguments),r=o,t=0;t<n.length;t+=1)if("function"==typeof n[t][r])try{i=n[t][r].apply(null,e),c>r&&f(i,n[t]._)}catch(u){n[t]._[a](u)}else c>r&&n[t]._[r].apply(null,e);c>r&&(n=null)}}};return o(c),o(s),o(a),t.then=function(){var t=[].slice.call(arguments);return t._=p({}),n?n.push(t):"function"==typeof t[r]&&l(function(){f(t[r].apply(null,e),t._)}),t._},t},d=function(t){return"object"==typeof t&&null!==t&&(global.ArrayBufferView&&t instanceof ArrayBufferView||global.Int8Array&&t instanceof Int8Array||global.Uint8Array&&t instanceof Uint8Array||global.Uint8ClampedArray&&t instanceof Uint8ClampedArray||global.Int16Array&&t instanceof Int16Array||global.Uint16Array&&t instanceof Uint16Array||global.Int32Array&&t instanceof Int32Array||global.Uint32Array&&t instanceof Uint32Array||global.Float32Array&&t instanceof Float32Array||global.Float64Array&&t instanceof Float64Array)},h=function(t){return"[object Array]"===Object.prototype.toString.call(t)},y=function(t){return"object"==typeof t&&null!==t&&global.FormData&&t instanceof global.FormData},v=function(t){return"object"==typeof t&&null!==t&&(global.Buffer&&t instanceof Buffer||global.Blob&&t instanceof Blob||global.File&&t instanceof File||global.ArrayBuffer&&t instanceof ArrayBuffer||d(t)||h(t))},m=",GET,HEAD,PATCH,POST,PUT,DELETE,",g=function(t){return t},b=/^[a-z][a-z0-9.+-]*:/i,w=function(t,e){"use strict";if("function"!=typeof e)throw new Error("TODO error");if(!this._hooks[t])throw new Error("TODO error");var n=A();for(var r in this._hooks)this._hooks.hasOwnProperty(r)&&n._hooks[r].push.apply(n._hooks[r],this._hooks[r]);return n._hooks[t].push(e),n},_=function(){return{finished:[],downloading:[],uploading:[],gotStatus:[]}},T=function(t,e){"use strict";return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},x=new Buffer([]),j=function(t){"use strict";if(128>t)return 1;var e=192,n=128;if((t&e)===n)return 0;for(var r=1;(t&e)!==n;r+=1)e=e>>1|128,n=n>>1|128;return r},A=function(){"use strict";var t=function(e,n,f,w){var _,A,E,C,O,k,S,P,B,R,q,U,z,H,L,D,F,M;_=function(e,n){for(var r=t._hooks[e],o=0;o<r.length;o+=1)n=r[o].apply(null,n);return n};var I,G,N;n?f?w?f.finished=w:"object"==typeof n?(n.finished=f,f=n,n="GET"):"function"==typeof f&&(f={finished:f}):"string"==typeof n?f={}:"object"==typeof n?(f=n,n="GET"):(f={finished:n},n="GET"):(n="GET",f={});var Q=function(t,e,n){return function(){var r,o=[],i=!1,u=function(e,n){return r=w,w=null,l(function(){if(r&&r(e),A(),!r&&!i)throw e}),"finished"===t?[e]:n};e.apply(null,o);try{o=_(t,[].slice.call(arguments))}catch(s){i=!0,o=u(s,o)}if(f[t])try{f[t].apply(null,o)}catch(s){o=u(s,o)}n.apply(null,o)}};E=function(t,e){return e instanceof Error||(e=new Error("Error code #"+e+". See https://github.com/jakutis/httpinvoke#error-codes")),l(function(){null!==t&&t(e)}),A=function(){},p(A)},C=Q("uploading",g,function(t,e){A[c]({type:"upload",current:t,total:e})}),O=Q("downloading",g,function(t,e,n){A[c]({type:"download",current:t,total:e,partial:n})}),P=Q("gotStatus",function(){P=null,I&&setTimeout(function(){w&&(w(new Error("download timeout")),A())},I)},function(t,e){A[c]({type:"headers",statusCode:t,headers:e})}),w=Q("finished",function(){w=null,A()},function(t,e,n,r){var o={body:e,statusCode:n,headers:r};return t?A[a](t,o):void A[s](o)});var X,V=f.converters||{};S=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(f.headers||{}),B={},R=f.corsExposedHeaders||[],R.push.apply(R,["Cache-Control","Content-Language","Content-Type","Content-Length","Expires","Last-Modified","Pragma","Content-Range","Content-Encoding"]);var J=function(e){var n=t.forbiddenInputHeaders.indexOf("sec-*")>=0,r=t.forbiddenInputHeaders.indexOf("proxy-*")>=0;for(var o in e)if(e.hasOwnProperty(o)){var i=o.toLowerCase();if(t.forbiddenInputHeaders.indexOf(i)>=0)throw[14,o];if(r&&"proxy-"===i.substr(0,"proxy-".length))throw[15,o];if(n&&"sec-"===i.substr(0,"sec-".length))throw[16,o]}};try{J(S)}catch(K){return E(w,K)}if(!t.relativeURLs&&!b.test(e))return E(w,[26,e]);if(D=e.substr(0,e.indexOf(":")),b.test(e)&&"http"!==D&&"https"!==D)return E(w,[25,D]);F="undefined"==typeof f.anonymous?t.anonymousByDefault:f.anonymous,M="undefined"==typeof f.system?t.systemByDefault:f.system,"undefined"!=typeof f.system&&M&&(F=!0);var W=f.partialOutputMode||"disabled";if(W.indexOf(",")>=0||",disabled,chunked,joined,".indexOf(","+W+",")<0)return E(w,[3]);if(n.indexOf(",")>=0||!t.anyMethod&&m.indexOf(","+n+",")<0)return E(w,[4,n]);var $=f.outputType;if(U="bytearray"===$,!$||"text"===$||U)L=g;else if(V["text "+$])L=V["text "+$],U=!1;else{if(!V["bytearray "+$])return E(w,[5,$]);L=V["bytearray "+$],U=!0}X=g;var Y=f.inputType;if(z=f.input,z!==r){if(Y&&"auto"!==Y)if("text"===Y){if("string"!=typeof z)return E(w,[7])}else if("formdata"===Y){if(!y(z))return E(w,[8])}else if("bytearray"===Y){if(!v(z))return E(w,[9])}else if(V[Y+" text"])X=V[Y+" text"];else if(V[Y+" bytearray"])X=V[Y+" bytearray"];else{if(!V[Y+" formdata"])return E(w,[10,Y]);X=V[Y+" formdata"]}else if("string"!=typeof z&&!v(z)&&!y(z))return E(w,[6]);"object"!=typeof z||y(z)||(global.ArrayBuffer&&z instanceof global.ArrayBuffer?z=new global.Uint8Array(z):d(z)&&(z=new global.Uint8Array(z.buffer,z.byteOffset,z.byteLength)));try{z=X(z)}catch(K){return E(w,K)}}else{if(Y&&"auto"!==Y)return E(w,[11]);if(S["Content-Type"])return E(w,[12])}var Z=function(t){return t>0&&1073741824>t},te=f.timeout;if(te!==r)if("number"==typeof te&&Z(te))N=te;else{if(!(h(te)&&2===te.length&&Z(te[0])&&Z(te[1])))return E(w,[13]);t.corsFineGrainedTimeouts||!crossDomain?(G=te[0],I=te[1]):N=te[0]+te[1]}G&&setTimeout(function(){P&&(w(new Error("upload timeout")),A())},G),N&&setTimeout(function(){w&&(w(new Error("timeout")),A())},N),S=T(S,{}),"undefined"!=typeof z?(z=new Buffer(z),k=z.length,S["Content-Length"]=String(k)):k=0,S["Accept-Encoding"]="gzip, deflate, identity";var ee=function(t){t.on("data",g),t.on("end",g)};e=o(e);var ne=u[D].request({hostname:e.hostname,port:Number(e.port),path:e.path,method:n,headers:S},function(t){var e;if(!w)return ee(t);if(B=t.headers,"content-encoding"in B){if(e=B["content-encoding"],["identity","gzip","deflate"].indexOf(e)<0)return w(new Error("unsupported Content-Encoding "+e)),w=null,ee(t);delete B["content-encoding"]}else e="identity";if(q=t.statusCode,C(k,k),!w)return ee(t);if(P(q,B),!w)return ee(t);"identity"===e&&"content-length"in B&&(H=Number(B["content-length"]));var o="disabled"===W?r:U?[]:"";if(O(0,H,o),!w)return ee(t);if("HEAD"===n)return ee(t),O(0,0,o),w&&w(null,r,q,B);var u;"identity"===e?u=t:(u=i["create"+("gzip"===e?"Gunzip":"InflateRaw")](),t.pipe(u));var s=[],a=0,c=x;u.on("data",function(t){if(w){if("disabled"!==W&&!U){t=Buffer.concat([c,t]);for(var e=0,n=0;0===e&&n<t.length;)n+=1,e=j(t[t.length-n]);n===e?c=x:(c=t.slice(t.length-n),t=t.slice(0,t.length-n))}a+=t.length,s.push(t);var r;"disabled"!==W&&(r="chunked"===W?t:Buffer.concat(s),U||(r=r.toString("utf8"))),O(a,H,r)}}),u.on("error",w),u.on("end",function(){if(w){if(s.push(c),a+=c.length,"undefined"==typeof H&&(H=a),a!==H)return w(new Error("network error"));s=Buffer.concat(s,a),U||(s=s.toString("utf8"));var t;if("chunked"===W?t=U?c:c.toString("utf8"):"joined"===W&&(t=U?s:s.toString("utf8")),O(H,H,t),w){if(0===H&&"undefined"==typeof B["content-type"])return w(null,r,q,B);try{w(null,L(s),q,B)}catch(e){w(e)}}}})});return l(function(){w&&C(0,k)}),"undefined"!=typeof z&&ne.write(z),ne.on("error",function(){w&&w(new Error("network error"))}),ne.end(),A=function(){w&&w(new Error("abort"))},p(A)};return t.corsResponseContentTypeOnly=!1,t.corsRequestHeaders=!0,t.corsCredentials=!0,t.cors=!0,t.corsDELETE=!0,t.corsHEAD=!0,t.corsPATCH=!0,t.corsPUT=!0,t.corsStatus=!0,t.corsResponseTextOnly=!1,t.requestTextOnly=!1,t.PATCH=!0,t.corsFineGrainedTimeouts=!0,t.anyMethod=!0,t.relativeURLs=!1,t.anonymousOption=!1,t.anonymousByDefault=!0,t.systemOption=!1,t.systemByDefault=!0,t.forbiddenInputHeaders=[],t._hooks=_(),t.hook=w,t};module.exports=A()}else!function(t,e){"function"==typeof n&&n.amd?n("httpinvoke",e):"object"==typeof exports?module.exports=e():t.httpinvoke=e()}(this,function(){"use strict";var t;t=window;var e,n,r,o=0,i=1,u=2,s=function(t,e){t&&t.then?t.then(function(){e[o].apply(null,arguments)},function(){e[i].apply(null,arguments)},function(){e[u].apply(null,arguments)}):e[o](t)},a=t.process&&t.process.nextTick||t.setImmediate||t.setTimeout,c=function(t){var e,n=[],r=u,f=function(o){t[o]=function(){var t,a;if(n){for(e=[].slice.call(arguments),r=o,t=0;t<n.length;t+=1)if("function"==typeof n[t][r])try{a=n[t][r].apply(null,e),u>r&&s(a,n[t]._)}catch(c){n[t]._[i](c)}else u>r&&n[t]._[r].apply(null,e);u>r&&(n=null)}}};return f(u),f(o),f(i),t.then=function(){var t=[].slice.call(arguments);return t._=c({}),n?n.push(t):"function"==typeof t[r]&&a(function(){s(t[r].apply(null,e),t._)}),t._},t},f=function(e){return"object"==typeof e&&null!==e&&(t.ArrayBufferView&&e instanceof ArrayBufferView||t.Int8Array&&e instanceof Int8Array||t.Uint8Array&&e instanceof Uint8Array||t.Uint8ClampedArray&&e instanceof Uint8ClampedArray||t.Int16Array&&e instanceof Int16Array||t.Uint16Array&&e instanceof Uint16Array||t.Int32Array&&e instanceof Int32Array||t.Uint32Array&&e instanceof Uint32Array||t.Float32Array&&e instanceof Float32Array||t.Float64Array&&e instanceof Float64Array)},l=function(t){return"[object Array]"===Object.prototype.toString.call(t)},p=function(e){return"object"==typeof e&&null!==e&&t.FormData&&e instanceof t.FormData},d=function(e){return"object"==typeof e&&null!==e&&(t.Buffer&&e instanceof Buffer||t.Blob&&e instanceof Blob||t.File&&e instanceof File||t.ArrayBuffer&&e instanceof ArrayBuffer||f(e)||l(e))},h=",GET,HEAD,PATCH,POST,PUT,DELETE,",y=function(t){return t},v=/^[a-z][a-z0-9.+-]*:/i,m=function(t,e){if("function"!=typeof e)throw new Error("TODO error");if(!this._hooks[t])throw new Error("TODO error");var n=k();for(var r in this._hooks)this._hooks.hasOwnProperty(r)&&n._hooks[r].push.apply(n._hooks[r],this._hooks[r]);return n._hooks[t].push(e),n},g=function(){return{finished:[],downloading:[],uploading:[],gotStatus:[]}},b=function(){for(var t=arguments.length,e={};t--;)for(var n=arguments[t].split(","),r=n.length;r--;)e[n[r]]=100*(t+1)+r;return e}("Continue,Switching Protocols","OK,Created,Accepted,Non-Authoritative Information,No Content,Reset Content,Partial Content","Multiple Choices,Moved Permanently,Found,See Other,Not Modified,Use Proxy,_,Temporary Redirect","Bad Request,Unauthorized,Payment Required,Forbidden,Not Found,Method Not Allowed,Not Acceptable,Proxy Authentication Required,Request Timeout,Conflict,Gone,Length Required,Precondition Failed,Request Entity Too Large,Request-URI Too Long,Unsupported Media Type,Requested Range Not Satisfiable,Expectation Failed","Internal Server Error,Not Implemented,Bad Gateway,Service Unavailable,Gateway Time-out,HTTP Version Not Supported"),w=t.Uint8Array?function(t){return new Uint8Array(t)}:y,_=function(t,e){for(var n=e.length;n<t.length;)e.push(255&t.charCodeAt(n++));return e},T=function(t){for(var e,n=0,r=t.length;r--;)e=t.charCodeAt(r),n+=128>e?1:2048>e?2:3;return n};try{execScript("Function httpinvoke0(B,A,C)\r\nDim i\r\nFor i=C to LenB(B)\r\nA.push(AscB(MidB(B,i,1)))\r\nNext\r\nEnd Function\r\nFunction httpinvoke1(B)\r\nhttpinvoke1=LenB(B)\r\nEnd Function","vbscript"),n=function(t,e){return httpinvoke0(t,e,e.length+1),e},r=function(t){return httpinvoke1(t)}}catch(x){}var j=function(t,e){return"responseBody"in t&&n?n(t.responseBody,e):_(t.responseText,e)},A=function(t){return"responseBody"in t&&r?r(t.responseBody):t.responseText.length},E=function(t,e){for(var n,r=t.getAllResponseHeaders().split(/\r?\n/),o=!1,i=r.length;i--;)(n=r[i].indexOf(":"))>=0&&(e[r[i].substr(0,n).toLowerCase()]=r[i].substr(n+2),o=!0);return o},C=/^(?:([a-z][a-z0-9.+-]*:)|)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,O=function(t,e){if(!v.test(e)&&"//"!==e.substr(0,2))return!1;e=C.exec(e.toLowerCase()),t=C.exec(t.toLowerCase())||[];var n=t[3]||("http:"===t[1]?"80":"443");return!!(e[1]&&e[1]!==t[1]||e[2]!==t[2]||(e[3]||(e[1]?"http:"===e[1]?"80":"443":n))!==n)},k=function(){var n,s=function(m,g,x,C){var k,S,P,B,R,q,U,z,H,L,D,F,M,I,G,N,Q,X;k=function(t,e){for(var n=s._hooks[t],r=0;r<n.length;r+=1)e=n[r].apply(null,e);return e};var V,J,K;g?x?C?x.finished=C:"object"==typeof g?(g.finished=x,x=g,g="GET"):"function"==typeof x&&(x={finished:x}):"string"==typeof g?x={}:"object"==typeof g?(x=g,g="GET"):(x={finished:g},g="GET"):(g="GET",x={});var W=function(t,e,n){return function(){var r,o=[],i=!1,u=function(e,n){return r=C,C=null,a(function(){if(r&&r(e),S(),!r&&!i)throw e}),"finished"===t?[e]:n};e.apply(null,o);try{o=k(t,[].slice.call(arguments))}catch(s){i=!0,o=u(s,o)}if(x[t])try{x[t].apply(null,o)}catch(s){o=u(s,o)}n.apply(null,o)}};P=function(t,e){return e instanceof Error||(e=new Error("Error code #"+e+". See https://github.com/jakutis/httpinvoke#error-codes")),a(function(){null!==t&&t(e)}),S=function(){},c(S)},B=W("uploading",y,function(t,e){S[u]({type:"upload",current:t,total:e})}),R=W("downloading",y,function(t,e,n){S[u]({type:"download",current:t,total:e,partial:n})}),z=W("gotStatus",function(){z=null,V&&setTimeout(function(){C&&(C(new Error("download timeout")),S())},V)},function(t,e){S[u]({type:"headers",statusCode:t,headers:e})}),C=W("finished",function(){C=null,S()},function(t,e,n,r){var u={body:e,statusCode:n,headers:r};return t?S[i](t,u):void S[o](u)});var $,Y=x.converters||{};U=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(x.headers||{}),H={},L=x.corsExposedHeaders||[],L.push.apply(L,["Cache-Control","Content-Language","Content-Type","Content-Length","Expires","Last-Modified","Pragma","Content-Range","Content-Encoding"]);var Z=function(t){var e=s.forbiddenInputHeaders.indexOf("sec-*")>=0,n=s.forbiddenInputHeaders.indexOf("proxy-*")>=0;for(var r in t)if(t.hasOwnProperty(r)){var o=r.toLowerCase();if(s.forbiddenInputHeaders.indexOf(o)>=0)throw[14,r];if(n&&"proxy-"===o.substr(0,"proxy-".length))throw[15,r];if(e&&"sec-"===o.substr(0,"sec-".length))throw[16,r]}};try{Z(U)}catch(te){return P(C,te)}if(!s.relativeURLs&&!v.test(m))return P(C,[26,m]);if(N=m.substr(0,m.indexOf(":")),v.test(m)&&"http"!==N&&"https"!==N)return P(C,[25,N]);Q="undefined"==typeof x.anonymous?s.anonymousByDefault:x.anonymous,X="undefined"==typeof x.system?s.systemByDefault:x.system,"undefined"!=typeof x.system&&X&&(Q=!0);var ee=x.partialOutputMode||"disabled";if(ee.indexOf(",")>=0||",disabled,chunked,joined,".indexOf(","+ee+",")<0)return P(C,[3]);if(g.indexOf(",")>=0||!s.anyMethod&&h.indexOf(","+g+",")<0)return P(C,[4,g]);var ne=x.outputType;if(F="bytearray"===ne,!ne||"text"===ne||F)G=y;else if(Y["text "+ne])G=Y["text "+ne],F=!1;else{if(!Y["bytearray "+ne])return P(C,[5,ne]);G=Y["bytearray "+ne],F=!0}$=y;var re=x.inputType;if(M=x.input,M!==e){if(re&&"auto"!==re)if("text"===re){if("string"!=typeof M)return P(C,[7])}else if("formdata"===re){if(!p(M))return P(C,[8])}else if("bytearray"===re){if(!d(M))return P(C,[9])}else if(Y[re+" text"])$=Y[re+" text"];else if(Y[re+" bytearray"])$=Y[re+" bytearray"];else{if(!Y[re+" formdata"])return P(C,[10,re]);$=Y[re+" formdata"]}else if("string"!=typeof M&&!d(M)&&!p(M))return P(C,[6]);"object"!=typeof M||p(M)||(t.ArrayBuffer&&M instanceof t.ArrayBuffer?M=new t.Uint8Array(M):f(M)&&(M=new t.Uint8Array(M.buffer,M.byteOffset,M.byteLength)));try{M=$(M)}catch(te){return P(C,te)}}else{if(re&&"auto"!==re)return P(C,[11]);if(U["Content-Type"])return P(C,[12])}var oe=function(t){return t>0&&1073741824>t},ie=x.timeout;if(ie!==e)if("number"==typeof ie&&oe(ie))K=ie;else{if(!(l(ie)&&2===ie.length&&oe(ie[0])&&oe(ie[1])))return P(C,[13]);s.corsFineGrainedTimeouts||!fe?(J=ie[0],V=ie[1]):K=ie[0]+ie[1]}J&&setTimeout(function(){z&&(C(new Error("upload timeout")),S())},J),K&&setTimeout(function(){C&&(C(new Error("timeout")),S())},K);var ue,se,ae,ce,fe,le=!1,pe=0,de="disabled"===ee?e:F?[]:"",he=de,ye=function(){"disabled"!==ee&&(F?j(ue,de):de=ue.responseText,he="joined"===ee?de:de.slice(pe),pe=de.length)},ve=function(t){B&&(le||(le=!0,B(0,q),C))&&(B(t,q),t===q&&(B=null))};try{ce=location.href}catch(me){ce=document.createElement("a"),ce.href="",ce=ce.href}if(fe=O(ce,m),"object"==typeof M&&!p(M)&&s.requestTextOnly)return P(C,[17]);if(fe&&!s.cors)return P(C,[18]);for(ae=["DELETE","PATCH","PUT","HEAD"],se=ae.length;se-->0;)if(fe&&g===ae[se]&&!s["cors"+ae[se]])return P(C,[19,g]);if("PATCH"===g&&!s.PATCH)return P(C,[20]);if(!n)return P(C,[21]);ue=n(fe,{mozAnon:Q,mozSystem:X});try{ue.open(g,m,!0)}catch(ge){return P(C,[22,m])}s.corsCredentials&&("undefined"!=typeof x.anonymous&&!Q||x.corsCredentials&&"boolean"==typeof ue.withCredentials)&&(ue.withCredentials=!0),fe&&x.corsOriginHeader&&(U[x.corsOriginHeader]=location.protocol+"//"+location.host);var be=function(t,e,n){return"undefined"!=typeof t[e]?t[e]:"undefined"!=typeof t[n]?t[n]:0},we=function(t){C&&t.lengthComputable&&(q===e&&(q=be(t,"total","totalSize"),ve(0)),ve(be(t,"loaded","position")))};"upload"in ue?(ue.upload.onerror=function(){xe.error=!0,C&&C(new Error("network error"))},ue.upload.onprogress=we):"onuploadprogress"in ue&&(ue.onuploadprogress=we),"onerror"in ue&&(ue.onerror=function(){xe.error=!0,Ee()});var _e=function(t){Ae(!1);try{var e=be(t,"loaded","position");t.lengthComputable&&(I=be(t,"total","totalSize")),C&&I>=e&&!z&&(ye(),R(e,I,he))}catch(n){}};"onloadstart"in ue&&(ue.onloadstart=_e),"onloadend"in ue&&(ue.onloadend=_e),"onprogress"in ue&&(ue.onprogress=_e);var Te,xe={},je=function(t){try{ue.status&&(xe.status=!0)}catch(n){}try{ue.statusText&&(xe.status=!0)}catch(n){}try{ue.responseText&&(xe.entity=!0)}catch(n){}try{ue.response&&(xe.entity=!0)}catch(n){}try{r(ue.responseBody)&&(xe.entity=!0)}catch(n){}if(z&&(xe.status||xe.entity||xe.success||t)){"string"==typeof ue.contentType&&ue.contentType&&("text/html"!==ue.contentType||""!==ue.responseText)&&(H["content-type"]=ue.contentType,xe.headers=!0);for(var o=0;o<L.length;o++){var i;try{(i=ue.getResponseHeader(L[o]))&&(H[L[o].toLowerCase()]=i,xe.headers=!0)}catch(u){}}try{E(ue,H)&&(xe.headers=!0)}catch(u){}if(Te="identity"===H["content-encoding"]||!fe&&!H["content-encoding"],Te&&"content-length"in H&&(I=Number(H["content-length"])),!D&&(!fe||s.corsStatus)){try{ue.status&&(D=ue.status)}catch(n){}if(!D)try{D=b[ue.statusText]}catch(n){}1223===D&&(D=204),D>=12001&&12156>=D&&(D=e)}}},Ae=function(t){return C&&(t||je(!1),z&&(t||xe.status&&xe.headers)&&(q===e&&(q=0,ve(0)),ve(q),C&&(z(D,H),C&&(R(0,I,he),C))))&&"HEAD"===g?(R(0,0,he),C&&C(null,e,D,H)):void 0},Ee=function(){if(C){je(!0);var t;try{t="disabled"!==ee?A(ue):F?"response"in ue?ue.response?ue.response.byteLength:0:A(ue):T(ue.responseText)}catch(n){t=0}if(I!==e){if(Te){if(t!==I&&"HEAD"!==g)return C(new Error("network error"))}else if(xe.error)return C(new Error("network error"))}else I=t;var r=!xe.entity&&0===I&&H["content-type"]===e;if(r&&200===D||!xe.success&&!D&&(xe.error||"onreadystatechange"in ue&&!xe.readyStateLOADING))return C(new Error("network error"));if(Ae(!0),C){if(r)return R(0,0,he),C(null,e,D,H);if(ye(),R(I,I,he),C)try{C(null,G(de||(F?w("response"in ue?ue.response||[]:j(ue,[])):ue.responseText)),D,H)}catch(o){C(o)}}}},Ce="onload"in ue;if(Ce&&(ue.onload=function(){xe.success=!0,Ee()}),"onreadystatechange"in ue&&(ue.onreadystatechange=function(){2===ue.readyState?Ae(!1):3===ue.readyState?(xe.readyStateLOADING=!0,Ae(!1)):4!==ue.readyState||Ce||Ee()}),!fe||s.corsRequestHeaders)for(var Oe in U)if(U.hasOwnProperty(Oe))try{ue.setRequestHeader(Oe,U[Oe])}catch(te){return P(C,[23,Oe])}return a(function(){if(C){if(F)try{"disabled"===ee&&"response"in ue?ue.responseType="arraybuffer":ue.overrideMimeType("text/plain; charset=x-user-defined")}catch(e){}if(p(M))try{ue.send(M)}catch(n){return P(C,[24])}else if("object"==typeof M){var r=!1,o=!1,i=!1,u=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder;l(M)&&(M=t.Uint8Array?new Uint8Array(M):String.fromCharCode.apply(String,M));var s=u?function(){var t=new u;t.append(M),M=t.getBlob(U["Content-Type"]||"application/octet-stream")}:function(){try{M=new Blob([M],{type:U["Content-Type"]||"application/octet-stream"})}catch(t){o=!0}},c=function(){var e;if(o&&r&&i)return P(C,[24]);if(f(M))if(r)if(i)o||s();else try{M=String.fromCharCode.apply(String,M)}catch(n){i=!0}else{q=M.byteLength;try{return void ue.send(t.ArrayBufferView?M:0===M.byteOffset&&M.length===M.buffer.byteLength?M.buffer:M.buffer.slice?M.buffer.slice(M.byteOffset,M.byteOffset+M.length):new Uint8Array([].slice.call(new Uint8Array(M.buffer),M.byteOffset,M.byteOffset+M.length)).buffer)}catch(n){}r=!0}else if(t.Blob&&M instanceof Blob)if(o)if(r){if(!i)try{return e=new FileReader,e.onerror=function(){i=!0,c()},e.onload=function(){M=e.result,c()},void e.readAsBinaryString(M)}catch(n){i=!0}}else try{return e=new FileReader,e.onerror=function(){r=!0,c()},e.onload=function(){try{M=new Uint8Array(e.result)}catch(t){r=!0}c()},void e.readAsArrayBuffer(M)}catch(n){r=!0}else try{return q=M.size,void ue.send(M)}catch(n){o=!0}else if(i)if(r)o||s();else try{M=_(M,[])}catch(n){r=!0}else try{return q=M.length,void ue.sendAsBinary(M)}catch(n){i=!0}a(c)};c(),ve(0)}else{try{"string"==typeof M?(q=T(M),ue.send(M)):(q=0,ue.send(null))}catch(n){return P(C,[24])}ve(0)}}}),S=function(){C&&C(new Error("abort"));try{ue.abort()}catch(t){}},c(S)};return s.corsResponseContentTypeOnly=!1,s.corsRequestHeaders=!1,s.corsCredentials=!1,s.cors=!1,s.corsDELETE=!1,s.corsHEAD=!1,s.corsPATCH=!1,s.corsPUT=!1,s.corsStatus=!1,s.corsResponseTextOnly=!1,s.corsFineGrainedTimeouts=!0,s.requestTextOnly=!1,s.anyMethod=!1,s.relativeURLs=!0,function(){try{n=function(t,e){return new XMLHttpRequest(e)};var r=n();if(s.requestTextOnly=!t.Uint8Array&&!r.sendAsBinary,s.cors="withCredentials"in r,s.cors)return s.corsRequestHeaders=!0,s.corsCredentials=!0,s.corsDELETE=!0,s.corsPATCH=!0,s.corsPUT=!0,s.corsHEAD=!0,void(s.corsStatus=!0)}catch(o){}try{return void(t.XDomainRequest===e?(n=function(t,e){return new XMLHttpRequest(e)})():(n=function(t,e){return t?new XDomainRequest:new XMLHttpRequest(e)},n(!0),s.cors=!0,s.corsResponseContentTypeOnly=!0,s.corsResponseTextOnly=!0,s.corsFineGrainedTimeouts=!1))}catch(o){}try{return void n()}catch(o){}for(var i=["Microsoft.XMLHTTP","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP"],u=i.length;u--;)try{return n=function(){return new ActiveXObject(i[u])},n(),void(s.requestTextOnly=!0)}catch(o){}n=e}(),s.PATCH=!!function(){try{return n().open("PATCH",location.href,!0),1}catch(t){}}(),s._hooks=g(),s.hook=m,s.anonymousOption=function(){try{return n(!0,{mozAnon:!0}).mozAnon===!0&&n(!0,{mozAnon:!1}).mozAnon===!1&&n(!1,{mozAnon:!0}).mozAnon===!0&&n(!1,{mozAnon:!1}).mozAnon===!1}catch(t){return!1}}(),s.anonymousByDefault=!1,s.systemOption=function(){try{return n(!0,{mozAnon:!0,mozSystem:!0}).mozSystem===!0&&n(!0,{mozAnon:!0,mozSystem:!1}).mozSystem===!1&&n(!1,{mozAnon:!0,mozSystem:!0}).mozSystem===!0&&n(!1,{mozAnon:!0,mozSystem:!1}).mozSystem===!1}catch(t){return!1}}(),s.systemByDefault=!1,s.forbiddenInputHeaders=["proxy-*","sec-*","accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],s};return k()});return function(t){"use strict";t("when/lib/env",["require"],function(t){function e(){return"undefined"!=typeof process&&null!==process&&"function"==typeof process.nextTick}function n(){return"function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver}function r(t){function e(){var t=n;n=void 0,t()}var n,r=document.createTextNode(""),o=new t(e);o.observe(r,{characterData:!0});var i=0;return function(t){n=t,r.data=i^=1}}var o,i="undefined"!=typeof setTimeout&&setTimeout,u=function(t,e){return setTimeout(t,e)},s=function(t){return clearTimeout(t)},a=function(t){return i(t,0)};if(e())a=function(t){return process.nextTick(t)};else if(o=n())a=r(o);else if(!i){var c=t,f=c("vertx");u=function(t,e){return f.setTimer(e,t)},s=f.cancelTimer,a=f.runOnLoop||f.runOnContext}return{setTimer:u,clearTimer:s,asap:a}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)}),function(t){"use strict";t("when/lib/TimeoutError",[],function(){function t(e){Error.call(this),this.message=e,this.name=t.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/decorators/timed",["require","../env","../TimeoutError"],function(t){function e(t,e,r,o){return n.setTimer(function(){t(r,o,e)},e)}var n=t("../env"),r=t("../TimeoutError");return function(t){function o(t,n,r){e(i,t,n,r)}function i(t,e){e.resolve(t)}function u(t,e,n){var o="undefined"==typeof t?new r("timed out after "+n+"ms"):t;e.reject(o)}return t.prototype.delay=function(t){var e=this._beget();return this._handler.fold(o,t,void 0,e._handler),e},t.prototype.timeout=function(t,r){var o=this._beget(),i=o._handler,s=e(u,t,r,o._handler);return this._handler.visit(i,function(t){n.clearTimer(s),this.resolve(t)},function(t){n.clearTimer(s),this.reject(t)},i.notify),o},t}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)}),function(t){"use strict";t("when/lib/state",[],function(){function t(){return{state:"pending"}}function e(t){return{state:"rejected",reason:t}}function n(t){return{state:"fulfilled",value:t}}function r(r){var o=r.state();return 0===o?t():o>0?n(r.value):e(r.value)}return{pending:t,fulfilled:n,rejected:e,inspect:r}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/apply",[],function(){function t(t,n){function r(e,r,i){var u=t._defer(),s=i.length,a=new Array(s);return o({f:e,thisArg:r,args:i,params:a,i:s-1,call:n},u._handler),u}function o(e,r){if(e.i<0)return n(e.f,e.thisArg,e.params,r);var o=t._handler(e.args[e.i]);o.fold(i,e,void 0,r)}function i(t,e,n){t.params[t.i]=e,t.i-=1,o(t,n)}return arguments.length<2&&(n=e),r}function e(t,e,n,r){try{r.resolve(t.apply(e,n))}catch(o){r.reject(o)}}return t.tryCatchResolve=e,t})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/decorators/array",["require","../state","../apply"],function(t){var e=t("../state"),n=t("../apply");return function(t){function r(e){function n(t){f=null,this.resolve(t)}function r(t){this.resolved||(f.push(t),0===--c&&this.reject(f))}for(var o,i,u=t._defer(),s=u._handler,a=e.length>>>0,c=a,f=[],l=0;a>l;++l)if(i=e[l],void 0!==i||l in e){if(o=t._handler(i),o.state()>0){s.become(o),t._visitRemaining(e,l,o);break}o.visit(s,n,r)}else--c;return 0===c&&s.reject(new RangeError("any(): array must not be empty")),u}function o(e,n){function r(t){this.resolved||(f.push(t),0===--d&&(l=null,this.resolve(f)))}function o(t){this.resolved||(l.push(t),0===--i&&(f=null,this.reject(l)))}var i,u,s,a=t._defer(),c=a._handler,f=[],l=[],p=e.length>>>0,d=0;for(s=0;p>s;++s)u=e[s],(void 0!==u||s in e)&&++d;for(n=Math.max(n,0),i=d-n+1,d=Math.min(n,d),n>d?c.reject(new RangeError("some(): array must contain at least "+n+" item(s), but had "+d)):0===d&&c.resolve(f),s=0;p>s;++s)u=e[s],(void 0!==u||s in e)&&t._handler(u).visit(c,r,o,c.notify);return a}function i(e,n){return t._traverse(n,e)}function u(e,n){var r=g.call(e);return t._traverse(n,r).then(function(t){return s(r,t)})}function s(e,n){for(var r=n.length,o=new Array(r),i=0,u=0;r>i;++i)n[i]&&(o[u++]=t._handler(e[i]).value);return o.length=u,o}function a(t){return y(t.map(c))}function c(n){var r=t._handler(n);return 0===r.state()?h(n).then(e.fulfilled,e.rejected):(r._unreport(),e.inspect(r))}function f(t,e){return arguments.length>2?v.call(t,p(e),arguments[2]):v.call(t,p(e))}function l(t,e){return arguments.length>2?m.call(t,p(e),arguments[2]):m.call(t,p(e))}function p(t){return function(e,n,r){return d(t,void 0,[e,n,r])}}var d=n(t),h=t.resolve,y=t.all,v=Array.prototype.reduce,m=Array.prototype.reduceRight,g=Array.prototype.slice;return t.any=r,t.some=o,t.settle=a,t.map=i,t.filter=u,t.reduce=f,t.reduceRight=l,t.prototype.spread=function(t){return this.then(y).then(function(e){return t.apply(this,e)})},t}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)}),function(t){"use strict";t("when/lib/decorators/flow",[],function(){function t(){throw new TypeError("catch predicate must be a function")}function e(t,e){return n(e)?t instanceof e:e(t)}function n(t){return t===Error||null!=t&&t.prototype instanceof Error
}function r(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function o(t){return t}return function(n){function i(t,n){return function(r){return e(r,n)?t.call(this,r):c(r)}}function u(t,e,n,o){var i=t.call(e);return r(i)?s(i,n,o):n(o)}function s(t,e,n){return a(t).then(function(){return e(n)})}var a=n.resolve,c=n.reject,f=n.prototype["catch"];return n.prototype.done=function(t,e){this._handler.visit(this._handler.receiver,t,e)},n.prototype["catch"]=n.prototype.otherwise=function(e){return arguments.length<2?f.call(this,e):"function"!=typeof e?this.ensure(t):f.call(this,i(arguments[1],e))},n.prototype["finally"]=n.prototype.ensure=function(t){return"function"!=typeof t?this:this.then(function(e){return u(t,this,o,e)},function(e){return u(t,this,c,e)})},n.prototype["else"]=n.prototype.orElse=function(t){return this.then(void 0,function(){return t})},n.prototype["yield"]=function(t){return this.then(function(){return t})},n.prototype.tap=function(t){return this.then(t)["yield"](this)},n}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/decorators/fold",[],function(){return function(t){return t.prototype.fold=function(e,n){var r=this._beget();return this._handler.fold(function(n,r,o){t._handler(n).fold(function(t,n,r){r.resolve(e.call(this,n,t))},r,this,o)},n,r._handler.receiver,r._handler),r},t}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/decorators/inspect",["require","../state"],function(t){var e=t("../state").inspect;return function(t){return t.prototype.inspect=function(){return e(t._handler(this))},t}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)}),function(t){"use strict";t("when/lib/decorators/iterate",[],function(){return function(t){function e(t,e,r,o){return n(function(e){return[e,t(e)]},e,r,o)}function n(t,e,o,i){function u(i,u){return r(o(i)).then(function(){return n(t,e,o,u)})}return r(i).then(function(n){return r(e(n)).then(function(e){return e?n:r(t(n)).spread(u)})})}var r=t.resolve;return t.iterate=e,t.unfold=n,t}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/decorators/progress",[],function(){return function(t){return t.prototype.progress=function(t){return this.then(void 0,void 0,t)},t}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/decorators/with",[],function(){return function(t){return t.prototype["with"]=t.prototype.withThis=function(t){var e=this._beget(),n=e._handler;return n.receiver=t,this._handler.chain(n,t),e},t}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/format",[],function(){function t(t){var n="object"==typeof t&&null!==t&&t.stack?t.stack:e(t);return t instanceof Error?n:n+" (WARNING: non-Error used)"}function e(t){var e=String(t);return"[object Object]"===e&&"undefined"!=typeof JSON&&(e=n(t,e)),e}function n(t,e){try{return JSON.stringify(t)}catch(n){return e}}return{formatError:t,formatObject:e,tryStringify:n}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/decorators/unhandledRejection",["require","../env","../format"],function(t){function e(t){throw t}function n(){}var r=t("../env").setTimer,o=t("../format");return function(t){function i(t){t.handled||(d.push(t),f("Potentially unhandled rejection ["+t.id+"] "+o.formatError(t.value)))}function u(t){var e=d.indexOf(t);e>=0&&(d.splice(e,1),l("Handled previous rejection ["+t.id+"] "+o.formatObject(t.value)))}function s(t,e){p.push(t,e),null===h&&(h=r(a,0))}function a(){for(h=null;p.length>0;)p.shift()(p.shift())}var c,f=n,l=n;"undefined"!=typeof console&&(c=console,f="undefined"!=typeof c.error?function(t){c.error(t)}:function(t){c.log(t)},l="undefined"!=typeof c.info?function(t){c.info(t)}:function(t){c.log(t)}),t.onPotentiallyUnhandledRejection=function(t){s(i,t)},t.onPotentiallyUnhandledRejectionHandled=function(t){s(u,t)},t.onFatalRejection=function(t){s(e,t.value)};var p=[],d=[],h=null;return t}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)}),function(t){"use strict";t("when/lib/makePromise",[],function(){return function(t){function e(t,e){this._handler=t===b?e:n(t)}function n(t){function e(t){o.resolve(t)}function n(t){o.reject(t)}function r(t){o.notify(t)}var o=new _;try{t(e,n,r)}catch(i){n(i)}return o}function r(t){return q(t)?t:new e(b,new T(v(t)))}function o(t){return new e(b,new T(new A(t)))}function i(){return Z}function u(){return new e(b,new _)}function s(t,e){var n=new _(t.receiver,t.join().context);return new e(b,n)}function a(t){return f(N,null,t)}function c(t,e){return f(D,t,e)}function f(t,n,r){function o(e,o,u){u.resolved||l(r,i,e,t(n,o,e),u)}function i(t,e,n){f[t]=e,0===--c&&n.become(new j(f))}for(var u,s="function"==typeof n?o:i,a=new _,c=r.length>>>0,f=new Array(c),p=0;p<r.length&&!a.resolved;++p)u=r[p],void 0!==u||p in r?l(r,s,p,u,a):--c;return 0===c&&a.become(new j(f)),new e(b,a)}function l(t,e,n,r,o){if(U(r)){var i=m(r),u=i.state();0===u?i.fold(e,n,void 0,o):u>0?e(n,i.value,o):(o.become(i),p(t,n+1,i))}else e(n,r,o)}function p(t,e,n){for(var r=e;r<t.length;++r)d(v(t[r]),n)}function d(t,e){if(t!==e){var n=t.state();0===n?t.visit(t,void 0,t._unreport):0>n&&t._unreport()}}function h(t){return"object"!=typeof t||null===t?o(new TypeError("non-iterable passed to race()")):0===t.length?i():1===t.length?r(t[0]):y(t)}function y(t){var n,r,o,i=new _;for(n=0;n<t.length;++n)if(r=t[n],void 0!==r||n in t){if(o=v(r),0!==o.state()){i.become(o),p(t,n+1,o);break}o.visit(i,i.resolve,i.reject)}return new e(b,i)}function v(t){return q(t)?t._handler.join():U(t)?g(t):new j(t)}function m(t){return q(t)?t._handler.join():g(t)}function g(t){try{var e=t.then;return"function"==typeof e?new x(e,t):new j(t)}catch(n){return new A(n)}}function b(){}function w(){}function _(t,n){e.createContext(this,n),this.consumers=void 0,this.receiver=t,this.handler=void 0,this.resolved=!1}function T(t){this.handler=t}function x(t,e){_.call(this),V.enqueue(new P(t,e,this))}function j(t){e.createContext(this),this.value=t}function A(t){e.createContext(this),this.id=++$,this.value=t,this.handled=!1,this.reported=!1,this._report()}function E(t,e){this.rejection=t,this.context=e}function C(t){this.rejection=t}function O(){return new A(new TypeError("Promise cycle"))}function k(t,e){this.continuation=t,this.handler=e}function S(t,e){this.handler=e,this.value=t}function P(t,e,n){this._then=t,this.thenable=e,this.resolver=n}function B(t,e,n,r,o){try{t.call(e,n,r,o)}catch(i){r(i)}}function R(t,e,n,r){this.f=t,this.z=e,this.c=n,this.to=r,this.resolver=W,this.receiver=this}function q(t){return t instanceof e}function U(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function z(t,n,r,o){return"function"!=typeof t?o.become(n):(e.enterContext(n),F(t,n.value,r,o),void e.exitContext())}function H(t,n,r,o,i){return"function"!=typeof t?i.become(r):(e.enterContext(r),M(t,n,r.value,o,i),void e.exitContext())}function L(t,n,r,o,i){return"function"!=typeof t?i.notify(n):(e.enterContext(r),I(t,n,o,i),void e.exitContext())}function D(t,e,n){try{return t(e,n)}catch(r){return o(r)}}function F(t,e,n,r){try{r.become(v(t.call(n,e)))}catch(o){r.become(new A(o))}}function M(t,e,n,r,o){try{t.call(r,e,n,o)}catch(i){o.become(new A(i))}}function I(t,e,n,r){try{r.notify(t.call(n,e))}catch(o){r.notify(o)}}function G(t,e){e.prototype=K(t.prototype),e.prototype.constructor=e}function N(t,e){return e}function Q(){}function X(){return"undefined"!=typeof process&&null!==process&&"function"==typeof process.emit?function(t,e){return"unhandledRejection"===t?process.emit(t,e.value,e):process.emit(t,e)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(t,e,n){var r=!1;try{var o=new n("unhandledRejection");r=o instanceof n}catch(i){}return r?function(t,r){var o=new n(t,{detail:{reason:r.value,key:r},bubbles:!1,cancelable:!0});return!e.dispatchEvent(o)}:t}(Q,self,CustomEvent):Q}var V=t.scheduler,J=X(),K=Object.create||function(t){function e(){}return e.prototype=t,new e};e.resolve=r,e.reject=o,e.never=i,e._defer=u,e._handler=v,e.prototype.then=function(t,e,n){var r=this._handler,o=r.join().state();if("function"!=typeof t&&o>0||"function"!=typeof e&&0>o)return new this.constructor(b,r);var i=this._beget(),u=i._handler;return r.chain(u,r.receiver,t,e,n),i},e.prototype["catch"]=function(t){return this.then(void 0,t)},e.prototype._beget=function(){return s(this._handler,this.constructor)},e.all=a,e.race=h,e._traverse=c,e._visitRemaining=p,b.prototype.when=b.prototype.become=b.prototype.notify=b.prototype.fail=b.prototype._unreport=b.prototype._report=Q,b.prototype._state=0,b.prototype.state=function(){return this._state},b.prototype.join=function(){for(var t=this;void 0!==t.handler;)t=t.handler;return t},b.prototype.chain=function(t,e,n,r,o){this.when({resolver:t,receiver:e,fulfilled:n,rejected:r,progress:o})},b.prototype.visit=function(t,e,n,r){this.chain(W,t,e,n,r)},b.prototype.fold=function(t,e,n,r){this.when(new R(t,e,n,r))},G(b,w),w.prototype.become=function(t){t.fail()};var W=new w;G(b,_),_.prototype._state=0,_.prototype.resolve=function(t){this.become(v(t))},_.prototype.reject=function(t){this.resolved||this.become(new A(t))},_.prototype.join=function(){if(!this.resolved)return this;for(var t=this;void 0!==t.handler;)if(t=t.handler,t===this)return this.handler=O();return t},_.prototype.run=function(){var t=this.consumers,e=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var n=0;n<t.length;++n)e.when(t[n])},_.prototype.become=function(t){this.resolved||(this.resolved=!0,this.handler=t,void 0!==this.consumers&&V.enqueue(this),void 0!==this.context&&t._report(this.context))},_.prototype.when=function(t){this.resolved?V.enqueue(new k(t,this.handler)):void 0===this.consumers?this.consumers=[t]:this.consumers.push(t)},_.prototype.notify=function(t){this.resolved||V.enqueue(new S(t,this))},_.prototype.fail=function(t){var e="undefined"==typeof t?this.context:t;this.resolved&&this.handler.join().fail(e)},_.prototype._report=function(t){this.resolved&&this.handler.join()._report(t)},_.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},G(b,T),T.prototype.when=function(t){V.enqueue(new k(t,this))},T.prototype._report=function(t){this.join()._report(t)},T.prototype._unreport=function(){this.join()._unreport()},G(_,x),G(b,j),j.prototype._state=1,j.prototype.fold=function(t,e,n,r){H(t,e,this,n,r)},j.prototype.when=function(t){z(t.fulfilled,this,t.receiver,t.resolver)};var $=0;G(b,A),A.prototype._state=-1,A.prototype.fold=function(t,e,n,r){r.become(this)},A.prototype.when=function(t){"function"==typeof t.rejected&&this._unreport(),z(t.rejected,this,t.receiver,t.resolver)},A.prototype._report=function(t){V.afterQueue(new E(this,t))},A.prototype._unreport=function(){this.handled||(this.handled=!0,V.afterQueue(new C(this)))},A.prototype.fail=function(t){this.reported=!0,J("unhandledRejection",this),e.onFatalRejection(this,void 0===t?this.context:t)},E.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,J("unhandledRejection",this.rejection)||e.onPotentiallyUnhandledRejection(this.rejection,this.context))},C.prototype.run=function(){this.rejection.reported&&(J("rejectionHandled",this.rejection)||e.onPotentiallyUnhandledRejectionHandled(this.rejection))},e.createContext=e.enterContext=e.exitContext=e.onPotentiallyUnhandledRejection=e.onPotentiallyUnhandledRejectionHandled=e.onFatalRejection=Q;var Y=new b,Z=new e(b,Y);return k.prototype.run=function(){this.handler.join().when(this.continuation)},S.prototype.run=function(){var t=this.handler.consumers;if(void 0!==t)for(var e,n=0;n<t.length;++n)e=t[n],L(e.progress,this.value,this.handler,e.receiver,e.resolver)},P.prototype.run=function(){function t(t){r.resolve(t)}function e(t){r.reject(t)}function n(t){r.notify(t)}var r=this.resolver;B(this._then,this.thenable,t,e,n)},R.prototype.fulfilled=function(t){this.f.call(this.c,this.z,t,this.to)},R.prototype.rejected=function(t){this.to.reject(t)},R.prototype.progress=function(t){this.to.notify(t)},e}})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/Scheduler",[],function(){function t(t){this._async=t,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var e=this;this.drain=function(){e._drain()}}return t.prototype.enqueue=function(t){this._queue[this._queueLen++]=t,this.run()},t.prototype.afterQueue=function(t){this._afterQueue[this._afterQueueLen++]=t,this.run()},t.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},t.prototype._drain=function(){for(var t=0;t<this._queueLen;++t)this._queue[t].run(),this._queue[t]=void 0;for(this._queueLen=0,this._running=!1,t=0;t<this._afterQueueLen;++t)this._afterQueue[t].run(),this._afterQueue[t]=void 0;this._afterQueueLen=0},t})}("function"==typeof n&&n.amd?n:function(t){module.exports=t()}),function(t){"use strict";t("when/lib/Promise",["require","./makePromise","./Scheduler","./env"],function(t){var e=t("./makePromise"),n=t("./Scheduler"),r=t("./env").asap;return e({scheduler:new n(r)})})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)}),function(t){"use strict";t("when/when",["require","./lib/decorators/timed","./lib/decorators/array","./lib/decorators/flow","./lib/decorators/fold","./lib/decorators/inspect","./lib/decorators/iterate","./lib/decorators/progress","./lib/decorators/with","./lib/decorators/unhandledRejection","./lib/TimeoutError","./lib/Promise","./lib/apply"],function(t){function e(t,e,n,r){var o=x.resolve(t);return arguments.length<2?o:o.then(e,n,r)}function n(t){return new x(t)}function r(t){return function(){for(var e=0,n=arguments.length,r=new Array(n);n>e;++e)r[e]=arguments[e];return j(t,this,r)}}function o(t){for(var e=0,n=arguments.length-1,r=new Array(n);n>e;++e)r[e]=arguments[e+1];return j(t,this,r)}function i(){return new u}function u(){function t(t){r._handler.resolve(t)}function e(t){r._handler.reject(t)}function n(t){r._handler.notify(t)}var r=x._defer();this.promise=r,this.resolve=t,this.reject=e,this.notify=n,this.resolver={resolve:t,reject:e,notify:n}}function s(t){return t&&"function"==typeof t.then}function a(){return x.all(arguments)}function c(t){return e(t,x.all)}function f(t){return e(t,x.settle)}function l(t,n){return e(t,function(t){return x.map(t,n)})}function p(t,n){return e(t,function(t){return x.filter(t,n)})}var d=t("./lib/decorators/timed"),h=t("./lib/decorators/array"),y=t("./lib/decorators/flow"),v=t("./lib/decorators/fold"),m=t("./lib/decorators/inspect"),g=t("./lib/decorators/iterate"),b=t("./lib/decorators/progress"),w=t("./lib/decorators/with"),_=t("./lib/decorators/unhandledRejection"),T=t("./lib/TimeoutError"),x=[h,y,v,g,b,m,w,d,_].reduce(function(t,e){return e(t)},t("./lib/Promise")),j=t("./lib/apply")(x);return e.promise=n,e.resolve=x.resolve,e.reject=x.reject,e.lift=r,e["try"]=o,e.attempt=o,e.iterate=x.iterate,e.unfold=x.unfold,e.join=a,e.all=c,e.settle=f,e.any=r(x.any),e.some=r(x.some),e.race=r(x.race),e.map=l,e.filter=p,e.reduce=r(x.reduce),e.reduceRight=r(x.reduceRight),e.isPromiseLike=s,e.Promise=x,e.defer=i,e.TimeoutError=T,e})}("function"==typeof n&&n.amd?n:function(t){module.exports=t(e)}),n("when",["when/when"],function(t){return t}),n("_",["httpinvoke","when"],function(t,e){function n(){this.client=null,this.interfaces=o}var r={"text json":JSON.parse,"json text":JSON.stringify},o={};return n.client=null,n.interfaces=o,n.register=function(t,e){o[t]=e},n.prototype.register=n.register,n.request=function(n,o,i){var u=this.client.baseUrl+"/"+n;i="undefined"!=typeof i?i:{},i.converters=r,i.outputType="json",i.headers="undefined"!=typeof i.headers?i.headers:{},i.headers["trakt-api-key"]=this.client.id,i.headers["trakt-api-version"]=2,"undefined"==typeof i.headers.Authorization&&null!=this.client.authorization&&null!=this.client.authorization.access_token&&(i.headers.Authorization="Bearer "+this.client.authorization.access_token);var s=e.defer();return null==i.headers["trakt-api-key"]?(s.reject("missing api key"),s.promise):(t(u,o,i).then(function(t){t.statusCode>=200&&t.statusCode<=299?s.resolve(t.body):s.reject(t.body,t.statusCode,t.headers,null,t.statusText)},function(t){s.reject(null,null,null,null,t)}),s.promise)},n.prototype.request=n.request,n.get=function(t,e){return this.request(t,"GET",e)},n.prototype.get=n.get,n.post=function(t,e){return this.request(t,"POST",e)},n.prototype.post=n.post,n.cleanParameters=function(t){for(var e in t)t.hasOwnProperty(e)&&"undefined"==typeof t[e]&&delete t[e];return t},n.prototype.cleanParameters=n.cleanParameters,n.toQueryString=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")},n.prototype.toQueryString=n.toQueryString,n.getSiteUrl=function(){var t=this.client.baseUrl.split("://"),e=t[1].split(".");return e.shift(),[t[0],e.join(".")].join("://")},n.prototype.getSiteUrl=n.getSiteUrl,n}),n("interfaces/users/settings",["_"],function(t){function e(t){this._=t}e.prototype.get=function(){return this._.get("users/settings")},t.register("users/settings",e)}),n("interfaces/oauth",["_","when"],function(t,e){function n(t){this._=t}n.prototype.authorizeUrl=function(t,e){var n=this._.cleanParameters({response_type:"code",client_id:this._.client.id,redirect_uri:"undefined"!=typeof t?t:"urn:ietf:wg:oauth:2.0:oob",state:e});return null==n.client_id?(console.error('missing client "id" parameter'),null):null==n.redirect_uri?(console.error('invalid "redirect_uri" parameter provided'),null):this._.getSiteUrl()+"/oauth/authorize?"+this._.toQueryString(n)},n.prototype.token=function(t,n,r){var o=this._.cleanParameters({client_id:this._.client.id,client_secret:this._.client.secret,code:t,redirect_uri:"undefined"!=typeof n?n:"urn:ietf:wg:oauth:2.0:oob",grant_type:"undefined"!=typeof r?r:"authorization_code"});return null==o.client_id||null==o.client_secret?e.reject('missing client "id" or "secret" parameter'):null==o.code||null==o.redirect_uri||null==o.grant_type?e.reject('invalid "code", "redirect_uri" or "grant_type" parameter provided'):this._.post("oauth/token",{input:o,inputType:"json",headers:{"Content-Type":"application/json"}})},t.register("oauth",n)}),n("interfaces/scrobble",["_"],function(t){function e(t){this._=t}e.prototype.start=function(t){return this._.post("scrobble/start",{input:t,inputType:"json",headers:{"Content-Type":"application/json"}})},e.prototype.pause=function(t){return this._.post("scrobble/pause",{input:t,inputType:"json",headers:{"Content-Type":"application/json"}})},e.prototype.stop=function(t){return this._.post("scrobble/stop",{input:t,inputType:"json",headers:{"Content-Type":"application/json"}})},t.register("scrobble",e)}),n("interfaces/search",["_","when"],function(t,e){function n(t){this._=t}n.prototype.lookup=function(t,n){var r=this._.cleanParameters({id_type:t,id:n});return null==r.id_type||null==r.id?e.reject('"id_type" and "id" parameters are required'):this._.get("search?"+this._.toQueryString(r))},n.prototype.query=function(t,n,r){var o=this._.cleanParameters({query:t,type:n,year:r});return null==o.query?e.reject('"query" parameter is required'):this._.get("search?"+this._.toQueryString(o))},t.register("search",n)}),n("trakt",["_","interfaces/users/settings","interfaces/oauth","interfaces/scrobble","interfaces/search"],function(t){function e(e){for(var n in t.interfaces){if(!t.interfaces.hasOwnProperty(n))return;e.__defineGetter__(n,function(t){return function(){return new e._.interfaces[t](e._)}}(n))}}function n(n,i){this.baseUrl=r,this.version=o,this.id=n,this.secret=i,this.authorization=null,this._=new t,this._.client=this,e(this)}var r="https://api-v2launch.trakt.tv",o="1.0.0";return n._=t,n.baseUrl=r,n.version=o,n.id="574886e8a654562ba1453788c0c076adb53b78fc7425135e0db10dff01f51809",n.secret="1421a6b546de8ab27e3fe00596708ebc0051fe8fe856eedfb827ebd22b04372b",n.authorization=null,n._.client=n,e(n),{Client:n}}),e("trakt")});
//# sourceMappingURL=trakt.js
//# sourceMappingURL=trakt.js.map