!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.trakt=t()}(this,function(){var e,t,n;if(function(r){function o(e,t){return w.call(e,t)}function i(e,t){var n,r,o,i,u,s,a,c,f,l,p,d=t&&t.split("/"),h=g.map,y=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(t){for(d=d.slice(0,d.length-1),e=e.split("/"),u=e.length-1,g.nodeIdCompat&&T.test(e[u])&&(e[u]=e[u].replace(T,"")),e=d.concat(e),f=0;f<e.length;f+=1)if(p=e[f],"."===p)e.splice(f,1),f-=1;else if(".."===p){if(1===f&&(".."===e[2]||".."===e[0]))break;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||y)&&h){for(n=e.split("/"),f=n.length;f>0;f-=1){if(r=n.slice(0,f).join("/"),d)for(l=d.length;l>0;l-=1)if(o=h[d.slice(0,l).join("/")],o&&(o=o[r])){i=o,s=f;break}if(i)break;!a&&y&&y[r]&&(a=y[r],c=f)}!i&&a&&(i=a,s=c),i&&(n.splice(0,s,i),e=n.join("/"))}return e}function u(e,t){return function(){return d.apply(r,_.call(arguments,0).concat([e,t]))}}function s(e){return function(t){return i(t,e)}}function a(e){return function(t){v[e]=t}}function c(e){if(o(m,e)){var t=m[e];delete m[e],b[e]=!0,p.apply(r,t)}if(!o(v,e)&&!o(b,e))throw new Error("No "+e);return v[e]}function f(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return function(){return g&&g.config&&g.config[e]||{}}}var p,d,h,y,v={},m={},g={},b={},w=Object.prototype.hasOwnProperty,_=[].slice,T=/\.js$/;h=function(e,t){var n,r=f(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=c(o)),o?e=n&&n.normalize?n.normalize(e,s(t)):i(e,t):(e=i(e,t),r=f(e),o=r[0],e=r[1],o&&(n=c(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},y={require:function(e){return u(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:l(e)}}},p=function(e,t,n,i){var s,f,l,p,d,g,w=[],_=typeof n;if(i=i||e,"undefined"===_||"function"===_){for(t=!t.length&&n.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(p=h(t[d],i),f=p.f,"require"===f)w[d]=y.require(e);else if("exports"===f)w[d]=y.exports(e),g=!0;else if("module"===f)s=w[d]=y.module(e);else if(o(v,f)||o(m,f)||o(b,f))w[d]=c(f);else{if(!p.p)throw new Error(e+" missing "+f);p.p.load(p.n,u(i,!0),a(f),{}),w[d]=v[f]}l=n?n.apply(v[e],w):void 0,e&&(s&&s.exports!==r&&s.exports!==v[e]?v[e]=s.exports:l===r&&g||(v[e]=l))}else e&&(v[e]=n)},e=t=d=function(e,t,n,o,i){if("string"==typeof e)return y[e]?y[e](t):c(h(e,t).f);if(!e.splice){if(g=e,g.deps&&d(g.deps,g.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?p(r,e,t,n):setTimeout(function(){p(r,e,t,n)},4),d},d.config=function(e){return d(e)},e._defined=v,n=function(e,t,n){t.splice||(n=t,t=[]),o(v,e)||o(m,e)||(m[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),"undefined"!=typeof process&&"undefined"!=typeof process.versions&&"undefined"!=typeof process.versions.node){var r,o=t("url").parse,i=t("zlib"),u={http:t("http"),https:t("https")},s=0,a=1,c=2,f=function(e,t){e&&e.then?e.then(function(){t[s].apply(null,arguments)},function(){t[a].apply(null,arguments)},function(){t[c].apply(null,arguments)}):t[s](e)},l=global.process&&global.process.nextTick||global.setImmediate||global.setTimeout,p=function(e){var t,n=[],r=c,o=function(o){e[o]=function(){var e,i;if(n){for(t=[].slice.call(arguments),r=o,e=0;e<n.length;e+=1)if("function"==typeof n[e][r])try{i=n[e][r].apply(null,t),c>r&&f(i,n[e]._)}catch(u){n[e]._[a](u)}else c>r&&n[e]._[r].apply(null,t);c>r&&(n=null)}}};return o(c),o(s),o(a),e.then=function(){var e=[].slice.call(arguments);return e._=p({}),n?n.push(e):"function"==typeof e[r]&&l(function(){f(e[r].apply(null,t),e._)}),e._},e},d=function(e){return"object"==typeof e&&null!==e&&(global.ArrayBufferView&&e instanceof ArrayBufferView||global.Int8Array&&e instanceof Int8Array||global.Uint8Array&&e instanceof Uint8Array||global.Uint8ClampedArray&&e instanceof Uint8ClampedArray||global.Int16Array&&e instanceof Int16Array||global.Uint16Array&&e instanceof Uint16Array||global.Int32Array&&e instanceof Int32Array||global.Uint32Array&&e instanceof Uint32Array||global.Float32Array&&e instanceof Float32Array||global.Float64Array&&e instanceof Float64Array)},h=function(e){return"[object Array]"===Object.prototype.toString.call(e)},y=function(e){return"object"==typeof e&&null!==e&&global.FormData&&e instanceof global.FormData},v=function(e){return"object"==typeof e&&null!==e&&(global.Buffer&&e instanceof Buffer||global.Blob&&e instanceof Blob||global.File&&e instanceof File||global.ArrayBuffer&&e instanceof ArrayBuffer||d(e)||h(e))},m=",GET,HEAD,PATCH,POST,PUT,DELETE,",g=function(e){return e},b=/^[a-z][a-z0-9.+-]*:/i,w=function(e,t){"use strict";if("function"!=typeof t)throw new Error("TODO error");if(!this._hooks[e])throw new Error("TODO error");var n=A();for(var r in this._hooks)this._hooks.hasOwnProperty(r)&&n._hooks[r].push.apply(n._hooks[r],this._hooks[r]);return n._hooks[e].push(t),n},_=function(){return{finished:[],downloading:[],uploading:[],gotStatus:[]}},T=function(e,t){"use strict";return Object.keys(e).forEach(function(n){t[n]=e[n]}),t},x=new Buffer([]),j=function(e){"use strict";if(128>e)return 1;var t=192,n=128;if((e&t)===n)return 0;for(var r=1;(e&t)!==n;r+=1)t=t>>1|128,n=n>>1|128;return r},A=function(){"use strict";var e=function(t,n,f,w){var _,A,E,C,O,k,S,B,P,R,q,U,z,H,L,D,F,M;_=function(t,n){for(var r=e._hooks[t],o=0;o<r.length;o+=1)n=r[o].apply(null,n);return n};var I,G,N;n?f?w?f.finished=w:"object"==typeof n?(n.finished=f,f=n,n="GET"):"function"==typeof f&&(f={finished:f}):"string"==typeof n?f={}:"object"==typeof n?(f=n,n="GET"):(f={finished:n},n="GET"):(n="GET",f={});var Q=function(e,t,n){return function(){var r,o=[],i=!1,u=function(t,n){return r=w,w=null,l(function(){if(r&&r(t),A(),!r&&!i)throw t}),"finished"===e?[t]:n};t.apply(null,o);try{o=_(e,[].slice.call(arguments))}catch(s){i=!0,o=u(s,o)}if(f[e])try{f[e].apply(null,o)}catch(s){o=u(s,o)}n.apply(null,o)}};E=function(e,t){return t instanceof Error||(t=new Error("Error code #"+t+". See https://github.com/jakutis/httpinvoke#error-codes")),l(function(){null!==e&&e(t)}),A=function(){},p(A)},C=Q("uploading",g,function(e,t){A[c]({type:"upload",current:e,total:t})}),O=Q("downloading",g,function(e,t,n){A[c]({type:"download",current:e,total:t,partial:n})}),B=Q("gotStatus",function(){B=null,I&&setTimeout(function(){w&&(w(new Error("download timeout")),A())},I)},function(e,t){A[c]({type:"headers",statusCode:e,headers:t})}),w=Q("finished",function(){w=null,A()},function(e,t,n,r){var o={body:t,statusCode:n,headers:r};return e?A[a](e,o):void A[s](o)});var X,V=f.converters||{};S=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(f.headers||{}),P={},R=f.corsExposedHeaders||[],R.push.apply(R,["Cache-Control","Content-Language","Content-Type","Content-Length","Expires","Last-Modified","Pragma","Content-Range","Content-Encoding"]);var J=function(t){var n=e.forbiddenInputHeaders.indexOf("sec-*")>=0,r=e.forbiddenInputHeaders.indexOf("proxy-*")>=0;for(var o in t)if(t.hasOwnProperty(o)){var i=o.toLowerCase();if(e.forbiddenInputHeaders.indexOf(i)>=0)throw[14,o];if(r&&"proxy-"===i.substr(0,"proxy-".length))throw[15,o];if(n&&"sec-"===i.substr(0,"sec-".length))throw[16,o]}};try{J(S)}catch(K){return E(w,K)}if(!e.relativeURLs&&!b.test(t))return E(w,[26,t]);if(D=t.substr(0,t.indexOf(":")),b.test(t)&&"http"!==D&&"https"!==D)return E(w,[25,D]);F="undefined"==typeof f.anonymous?e.anonymousByDefault:f.anonymous,M="undefined"==typeof f.system?e.systemByDefault:f.system,"undefined"!=typeof f.system&&M&&(F=!0);var W=f.partialOutputMode||"disabled";if(W.indexOf(",")>=0||",disabled,chunked,joined,".indexOf(","+W+",")<0)return E(w,[3]);if(n.indexOf(",")>=0||!e.anyMethod&&m.indexOf(","+n+",")<0)return E(w,[4,n]);var $=f.outputType;if(U="bytearray"===$,!$||"text"===$||U)L=g;else if(V["text "+$])L=V["text "+$],U=!1;else{if(!V["bytearray "+$])return E(w,[5,$]);L=V["bytearray "+$],U=!0}X=g;var Y=f.inputType;if(z=f.input,z!==r){if(Y&&"auto"!==Y)if("text"===Y){if("string"!=typeof z)return E(w,[7])}else if("formdata"===Y){if(!y(z))return E(w,[8])}else if("bytearray"===Y){if(!v(z))return E(w,[9])}else if(V[Y+" text"])X=V[Y+" text"];else if(V[Y+" bytearray"])X=V[Y+" bytearray"];else{if(!V[Y+" formdata"])return E(w,[10,Y]);X=V[Y+" formdata"]}else if("string"!=typeof z&&!v(z)&&!y(z))return E(w,[6]);"object"!=typeof z||y(z)||(global.ArrayBuffer&&z instanceof global.ArrayBuffer?z=new global.Uint8Array(z):d(z)&&(z=new global.Uint8Array(z.buffer,z.byteOffset,z.byteLength)));try{z=X(z)}catch(K){return E(w,K)}}else{if(Y&&"auto"!==Y)return E(w,[11]);if(S["Content-Type"])return E(w,[12])}var Z=function(e){return e>0&&1073741824>e},et=f.timeout;if(et!==r)if("number"==typeof et&&Z(et))N=et;else{if(!(h(et)&&2===et.length&&Z(et[0])&&Z(et[1])))return E(w,[13]);e.corsFineGrainedTimeouts||!crossDomain?(G=et[0],I=et[1]):N=et[0]+et[1]}G&&setTimeout(function(){B&&(w(new Error("upload timeout")),A())},G),N&&setTimeout(function(){w&&(w(new Error("timeout")),A())},N),S=T(S,{}),"undefined"!=typeof z?(z=new Buffer(z),k=z.length,S["Content-Length"]=String(k)):k=0,S["Accept-Encoding"]="gzip, deflate, identity";var tt=function(e){e.on("data",g),e.on("end",g)};t=o(t);var nt=u[D].request({hostname:t.hostname,port:Number(t.port),path:t.path,method:n,headers:S},function(e){var t;if(!w)return tt(e);if(P=e.headers,"content-encoding"in P){if(t=P["content-encoding"],["identity","gzip","deflate"].indexOf(t)<0)return w(new Error("unsupported Content-Encoding "+t)),w=null,tt(e);delete P["content-encoding"]}else t="identity";if(q=e.statusCode,C(k,k),!w)return tt(e);if(B(q,P),!w)return tt(e);"identity"===t&&"content-length"in P&&(H=Number(P["content-length"]));var o="disabled"===W?r:U?[]:"";if(O(0,H,o),!w)return tt(e);if("HEAD"===n)return tt(e),O(0,0,o),w&&w(null,r,q,P);var u;"identity"===t?u=e:(u=i["create"+("gzip"===t?"Gunzip":"InflateRaw")](),e.pipe(u));var s=[],a=0,c=x;u.on("data",function(e){if(w){if("disabled"!==W&&!U){e=Buffer.concat([c,e]);for(var t=0,n=0;0===t&&n<e.length;)n+=1,t=j(e[e.length-n]);n===t?c=x:(c=e.slice(e.length-n),e=e.slice(0,e.length-n))}a+=e.length,s.push(e);var r;"disabled"!==W&&(r="chunked"===W?e:Buffer.concat(s),U||(r=r.toString("utf8"))),O(a,H,r)}}),u.on("error",w),u.on("end",function(){if(w){if(s.push(c),a+=c.length,"undefined"==typeof H&&(H=a),a!==H)return w(new Error("network error"));s=Buffer.concat(s,a),U||(s=s.toString("utf8"));var e;if("chunked"===W?e=U?c:c.toString("utf8"):"joined"===W&&(e=U?s:s.toString("utf8")),O(H,H,e),w){if(0===H&&"undefined"==typeof P["content-type"])return w(null,r,q,P);try{w(null,L(s),q,P)}catch(t){w(t)}}}})});return l(function(){w&&C(0,k)}),"undefined"!=typeof z&&nt.write(z),nt.on("error",function(){w&&w(new Error("network error"))}),nt.end(),A=function(){w&&w(new Error("abort"))},p(A)};return e.corsResponseContentTypeOnly=!1,e.corsRequestHeaders=!0,e.corsCredentials=!0,e.cors=!0,e.corsDELETE=!0,e.corsHEAD=!0,e.corsPATCH=!0,e.corsPUT=!0,e.corsStatus=!0,e.corsResponseTextOnly=!1,e.requestTextOnly=!1,e.PATCH=!0,e.corsFineGrainedTimeouts=!0,e.anyMethod=!0,e.relativeURLs=!1,e.anonymousOption=!1,e.anonymousByDefault=!0,e.systemOption=!1,e.systemByDefault=!0,e.forbiddenInputHeaders=[],e._hooks=_(),e.hook=w,e};module.exports=A()}else!function(e,t){"function"==typeof n&&n.amd?n("httpinvoke",t):"object"==typeof exports?module.exports=t():e.httpinvoke=t()}(this,function(){"use strict";var e;e=window;var t,n,r,o=0,i=1,u=2,s=function(e,t){e&&e.then?e.then(function(){t[o].apply(null,arguments)},function(){t[i].apply(null,arguments)},function(){t[u].apply(null,arguments)}):t[o](e)},a=e.process&&e.process.nextTick||e.setImmediate||e.setTimeout,c=function(e){var t,n=[],r=u,f=function(o){e[o]=function(){var e,a;if(n){for(t=[].slice.call(arguments),r=o,e=0;e<n.length;e+=1)if("function"==typeof n[e][r])try{a=n[e][r].apply(null,t),u>r&&s(a,n[e]._)}catch(c){n[e]._[i](c)}else u>r&&n[e]._[r].apply(null,t);u>r&&(n=null)}}};return f(u),f(o),f(i),e.then=function(){var e=[].slice.call(arguments);return e._=c({}),n?n.push(e):"function"==typeof e[r]&&a(function(){s(e[r].apply(null,t),e._)}),e._},e},f=function(t){return"object"==typeof t&&null!==t&&(e.ArrayBufferView&&t instanceof ArrayBufferView||e.Int8Array&&t instanceof Int8Array||e.Uint8Array&&t instanceof Uint8Array||e.Uint8ClampedArray&&t instanceof Uint8ClampedArray||e.Int16Array&&t instanceof Int16Array||e.Uint16Array&&t instanceof Uint16Array||e.Int32Array&&t instanceof Int32Array||e.Uint32Array&&t instanceof Uint32Array||e.Float32Array&&t instanceof Float32Array||e.Float64Array&&t instanceof Float64Array)},l=function(e){return"[object Array]"===Object.prototype.toString.call(e)},p=function(t){return"object"==typeof t&&null!==t&&e.FormData&&t instanceof e.FormData},d=function(t){return"object"==typeof t&&null!==t&&(e.Buffer&&t instanceof Buffer||e.Blob&&t instanceof Blob||e.File&&t instanceof File||e.ArrayBuffer&&t instanceof ArrayBuffer||f(t)||l(t))},h=",GET,HEAD,PATCH,POST,PUT,DELETE,",y=function(e){return e},v=/^[a-z][a-z0-9.+-]*:/i,m=function(e,t){if("function"!=typeof t)throw new Error("TODO error");if(!this._hooks[e])throw new Error("TODO error");var n=k();for(var r in this._hooks)this._hooks.hasOwnProperty(r)&&n._hooks[r].push.apply(n._hooks[r],this._hooks[r]);return n._hooks[e].push(t),n},g=function(){return{finished:[],downloading:[],uploading:[],gotStatus:[]}},b=function(){for(var e=arguments.length,t={};e--;)for(var n=arguments[e].split(","),r=n.length;r--;)t[n[r]]=100*(e+1)+r;return t}("Continue,Switching Protocols","OK,Created,Accepted,Non-Authoritative Information,No Content,Reset Content,Partial Content","Multiple Choices,Moved Permanently,Found,See Other,Not Modified,Use Proxy,_,Temporary Redirect","Bad Request,Unauthorized,Payment Required,Forbidden,Not Found,Method Not Allowed,Not Acceptable,Proxy Authentication Required,Request Timeout,Conflict,Gone,Length Required,Precondition Failed,Request Entity Too Large,Request-URI Too Long,Unsupported Media Type,Requested Range Not Satisfiable,Expectation Failed","Internal Server Error,Not Implemented,Bad Gateway,Service Unavailable,Gateway Time-out,HTTP Version Not Supported"),w=e.Uint8Array?function(e){return new Uint8Array(e)}:y,_=function(e,t){for(var n=t.length;n<e.length;)t.push(255&e.charCodeAt(n++));return t},T=function(e){for(var t,n=0,r=e.length;r--;)t=e.charCodeAt(r),n+=128>t?1:2048>t?2:3;return n};try{execScript("Function httpinvoke0(B,A,C)\r\nDim i\r\nFor i=C to LenB(B)\r\nA.push(AscB(MidB(B,i,1)))\r\nNext\r\nEnd Function\r\nFunction httpinvoke1(B)\r\nhttpinvoke1=LenB(B)\r\nEnd Function","vbscript"),n=function(e,t){return httpinvoke0(e,t,t.length+1),t},r=function(e){return httpinvoke1(e)}}catch(x){}var j=function(e,t){return"responseBody"in e&&n?n(e.responseBody,t):_(e.responseText,t)},A=function(e){return"responseBody"in e&&r?r(e.responseBody):e.responseText.length},E=function(e,t){for(var n,r=e.getAllResponseHeaders().split(/\r?\n/),o=!1,i=r.length;i--;)(n=r[i].indexOf(":"))>=0&&(t[r[i].substr(0,n).toLowerCase()]=r[i].substr(n+2),o=!0);return o},C=/^(?:([a-z][a-z0-9.+-]*:)|)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,O=function(e,t){if(!v.test(t)&&"//"!==t.substr(0,2))return!1;t=C.exec(t.toLowerCase()),e=C.exec(e.toLowerCase())||[];var n=e[3]||("http:"===e[1]?"80":"443");return!!(t[1]&&t[1]!==e[1]||t[2]!==e[2]||(t[3]||(t[1]?"http:"===t[1]?"80":"443":n))!==n)},k=function(){var n,s=function(m,g,x,C){var k,S,B,P,R,q,U,z,H,L,D,F,M,I,G,N,Q,X;k=function(e,t){for(var n=s._hooks[e],r=0;r<n.length;r+=1)t=n[r].apply(null,t);return t};var V,J,K;g?x?C?x.finished=C:"object"==typeof g?(g.finished=x,x=g,g="GET"):"function"==typeof x&&(x={finished:x}):"string"==typeof g?x={}:"object"==typeof g?(x=g,g="GET"):(x={finished:g},g="GET"):(g="GET",x={});var W=function(e,t,n){return function(){var r,o=[],i=!1,u=function(t,n){return r=C,C=null,a(function(){if(r&&r(t),S(),!r&&!i)throw t}),"finished"===e?[t]:n};t.apply(null,o);try{o=k(e,[].slice.call(arguments))}catch(s){i=!0,o=u(s,o)}if(x[e])try{x[e].apply(null,o)}catch(s){o=u(s,o)}n.apply(null,o)}};B=function(e,t){return t instanceof Error||(t=new Error("Error code #"+t+". See https://github.com/jakutis/httpinvoke#error-codes")),a(function(){null!==e&&e(t)}),S=function(){},c(S)},P=W("uploading",y,function(e,t){S[u]({type:"upload",current:e,total:t})}),R=W("downloading",y,function(e,t,n){S[u]({type:"download",current:e,total:t,partial:n})}),z=W("gotStatus",function(){z=null,V&&setTimeout(function(){C&&(C(new Error("download timeout")),S())},V)},function(e,t){S[u]({type:"headers",statusCode:e,headers:t})}),C=W("finished",function(){C=null,S()},function(e,t,n,r){var u={body:t,statusCode:n,headers:r};return e?S[i](e,u):void S[o](u)});var $,Y=x.converters||{};U=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(x.headers||{}),H={},L=x.corsExposedHeaders||[],L.push.apply(L,["Cache-Control","Content-Language","Content-Type","Content-Length","Expires","Last-Modified","Pragma","Content-Range","Content-Encoding"]);var Z=function(e){var t=s.forbiddenInputHeaders.indexOf("sec-*")>=0,n=s.forbiddenInputHeaders.indexOf("proxy-*")>=0;for(var r in e)if(e.hasOwnProperty(r)){var o=r.toLowerCase();if(s.forbiddenInputHeaders.indexOf(o)>=0)throw[14,r];if(n&&"proxy-"===o.substr(0,"proxy-".length))throw[15,r];if(t&&"sec-"===o.substr(0,"sec-".length))throw[16,r]}};try{Z(U)}catch(et){return B(C,et)}if(!s.relativeURLs&&!v.test(m))return B(C,[26,m]);if(N=m.substr(0,m.indexOf(":")),v.test(m)&&"http"!==N&&"https"!==N)return B(C,[25,N]);Q="undefined"==typeof x.anonymous?s.anonymousByDefault:x.anonymous,X="undefined"==typeof x.system?s.systemByDefault:x.system,"undefined"!=typeof x.system&&X&&(Q=!0);var tt=x.partialOutputMode||"disabled";if(tt.indexOf(",")>=0||",disabled,chunked,joined,".indexOf(","+tt+",")<0)return B(C,[3]);if(g.indexOf(",")>=0||!s.anyMethod&&h.indexOf(","+g+",")<0)return B(C,[4,g]);var nt=x.outputType;if(F="bytearray"===nt,!nt||"text"===nt||F)G=y;else if(Y["text "+nt])G=Y["text "+nt],F=!1;else{if(!Y["bytearray "+nt])return B(C,[5,nt]);G=Y["bytearray "+nt],F=!0}$=y;var rt=x.inputType;if(M=x.input,M!==t){if(rt&&"auto"!==rt)if("text"===rt){if("string"!=typeof M)return B(C,[7])}else if("formdata"===rt){if(!p(M))return B(C,[8])}else if("bytearray"===rt){if(!d(M))return B(C,[9])}else if(Y[rt+" text"])$=Y[rt+" text"];else if(Y[rt+" bytearray"])$=Y[rt+" bytearray"];else{if(!Y[rt+" formdata"])return B(C,[10,rt]);$=Y[rt+" formdata"]}else if("string"!=typeof M&&!d(M)&&!p(M))return B(C,[6]);"object"!=typeof M||p(M)||(e.ArrayBuffer&&M instanceof e.ArrayBuffer?M=new e.Uint8Array(M):f(M)&&(M=new e.Uint8Array(M.buffer,M.byteOffset,M.byteLength)));try{M=$(M)}catch(et){return B(C,et)}}else{if(rt&&"auto"!==rt)return B(C,[11]);if(U["Content-Type"])return B(C,[12])}var ot=function(e){return e>0&&1073741824>e},it=x.timeout;if(it!==t)if("number"==typeof it&&ot(it))K=it;else{if(!(l(it)&&2===it.length&&ot(it[0])&&ot(it[1])))return B(C,[13]);s.corsFineGrainedTimeouts||!ft?(J=it[0],V=it[1]):K=it[0]+it[1]}J&&setTimeout(function(){z&&(C(new Error("upload timeout")),S())},J),K&&setTimeout(function(){C&&(C(new Error("timeout")),S())},K);var ut,st,at,ct,ft,lt=!1,pt=0,dt="disabled"===tt?t:F?[]:"",ht=dt,yt=function(){"disabled"!==tt&&(F?j(ut,dt):dt=ut.responseText,ht="joined"===tt?dt:dt.slice(pt),pt=dt.length)},vt=function(e){P&&(lt||(lt=!0,P(0,q),C))&&(P(e,q),e===q&&(P=null))};try{ct=location.href}catch(mt){ct=document.createElement("a"),ct.href="",ct=ct.href}if(ft=O(ct,m),"object"==typeof M&&!p(M)&&s.requestTextOnly)return B(C,[17]);if(ft&&!s.cors)return B(C,[18]);for(at=["DELETE","PATCH","PUT","HEAD"],st=at.length;st-->0;)if(ft&&g===at[st]&&!s["cors"+at[st]])return B(C,[19,g]);if("PATCH"===g&&!s.PATCH)return B(C,[20]);if(!n)return B(C,[21]);ut=n(ft,{mozAnon:Q,mozSystem:X});try{ut.open(g,m,!0)}catch(gt){return B(C,[22,m])}s.corsCredentials&&("undefined"!=typeof x.anonymous&&!Q||x.corsCredentials&&"boolean"==typeof ut.withCredentials)&&(ut.withCredentials=!0),ft&&x.corsOriginHeader&&(U[x.corsOriginHeader]=location.protocol+"//"+location.host);var bt=function(e,t,n){return"undefined"!=typeof e[t]?e[t]:"undefined"!=typeof e[n]?e[n]:0},wt=function(e){C&&e.lengthComputable&&(q===t&&(q=bt(e,"total","totalSize"),vt(0)),vt(bt(e,"loaded","position")))};"upload"in ut?(ut.upload.onerror=function(){xt.error=!0,C&&C(new Error("network error"))},ut.upload.onprogress=wt):"onuploadprogress"in ut&&(ut.onuploadprogress=wt),"onerror"in ut&&(ut.onerror=function(){xt.error=!0,Et()});var _t=function(e){At(!1);try{var t=bt(e,"loaded","position");e.lengthComputable&&(I=bt(e,"total","totalSize")),C&&I>=t&&!z&&(yt(),R(t,I,ht))}catch(n){}};"onloadstart"in ut&&(ut.onloadstart=_t),"onloadend"in ut&&(ut.onloadend=_t),"onprogress"in ut&&(ut.onprogress=_t);var Tt,xt={},jt=function(e){try{ut.status&&(xt.status=!0)}catch(n){}try{ut.statusText&&(xt.status=!0)}catch(n){}try{ut.responseText&&(xt.entity=!0)}catch(n){}try{ut.response&&(xt.entity=!0)}catch(n){}try{r(ut.responseBody)&&(xt.entity=!0)}catch(n){}if(z&&(xt.status||xt.entity||xt.success||e)){"string"==typeof ut.contentType&&ut.contentType&&("text/html"!==ut.contentType||""!==ut.responseText)&&(H["content-type"]=ut.contentType,xt.headers=!0);for(var o=0;o<L.length;o++){var i;try{(i=ut.getResponseHeader(L[o]))&&(H[L[o].toLowerCase()]=i,xt.headers=!0)}catch(u){}}try{E(ut,H)&&(xt.headers=!0)}catch(u){}if(Tt="identity"===H["content-encoding"]||!ft&&!H["content-encoding"],Tt&&"content-length"in H&&(I=Number(H["content-length"])),!D&&(!ft||s.corsStatus)){try{ut.status&&(D=ut.status)}catch(n){}if(!D)try{D=b[ut.statusText]}catch(n){}1223===D&&(D=204),D>=12001&&12156>=D&&(D=t)}}},At=function(e){return C&&(e||jt(!1),z&&(e||xt.status&&xt.headers)&&(q===t&&(q=0,vt(0)),vt(q),C&&(z(D,H),C&&(R(0,I,ht),C))))&&"HEAD"===g?(R(0,0,ht),C&&C(null,t,D,H)):void 0},Et=function(){if(C){jt(!0);var e;try{e="disabled"!==tt?A(ut):F?"response"in ut?ut.response?ut.response.byteLength:0:A(ut):T(ut.responseText)}catch(n){e=0}if(I!==t){if(Tt){if(e!==I&&"HEAD"!==g)return C(new Error("network error"))}else if(xt.error)return C(new Error("network error"))}else I=e;var r=!xt.entity&&0===I&&H["content-type"]===t;if(r&&200===D||!xt.success&&!D&&(xt.error||"onreadystatechange"in ut&&!xt.readyStateLOADING))return C(new Error("network error"));if(At(!0),C){if(r)return R(0,0,ht),C(null,t,D,H);if(yt(),R(I,I,ht),C)try{C(null,G(dt||(F?w("response"in ut?ut.response||[]:j(ut,[])):ut.responseText)),D,H)}catch(o){C(o)}}}},Ct="onload"in ut;if(Ct&&(ut.onload=function(){xt.success=!0,Et()}),"onreadystatechange"in ut&&(ut.onreadystatechange=function(){2===ut.readyState?At(!1):3===ut.readyState?(xt.readyStateLOADING=!0,At(!1)):4!==ut.readyState||Ct||Et()}),!ft||s.corsRequestHeaders)for(var Ot in U)if(U.hasOwnProperty(Ot))try{ut.setRequestHeader(Ot,U[Ot])}catch(et){return B(C,[23,Ot])}return a(function(){if(C){if(F)try{"disabled"===tt&&"response"in ut?ut.responseType="arraybuffer":ut.overrideMimeType("text/plain; charset=x-user-defined")}catch(t){}if(p(M))try{ut.send(M)}catch(n){return B(C,[24])}else if("object"==typeof M){var r=!1,o=!1,i=!1,u=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder;l(M)&&(M=e.Uint8Array?new Uint8Array(M):String.fromCharCode.apply(String,M));var s=u?function(){var e=new u;e.append(M),M=e.getBlob(U["Content-Type"]||"application/octet-stream")}:function(){try{M=new Blob([M],{type:U["Content-Type"]||"application/octet-stream"})}catch(e){o=!0}},c=function(){var t;if(o&&r&&i)return B(C,[24]);if(f(M))if(r)if(i)o||s();else try{M=String.fromCharCode.apply(String,M)}catch(n){i=!0}else{q=M.byteLength;try{return void ut.send(e.ArrayBufferView?M:0===M.byteOffset&&M.length===M.buffer.byteLength?M.buffer:M.buffer.slice?M.buffer.slice(M.byteOffset,M.byteOffset+M.length):new Uint8Array([].slice.call(new Uint8Array(M.buffer),M.byteOffset,M.byteOffset+M.length)).buffer)}catch(n){}r=!0}else if(e.Blob&&M instanceof Blob)if(o)if(r){if(!i)try{return t=new FileReader,t.onerror=function(){i=!0,c()},t.onload=function(){M=t.result,c()},void t.readAsBinaryString(M)}catch(n){i=!0}}else try{return t=new FileReader,t.onerror=function(){r=!0,c()},t.onload=function(){try{M=new Uint8Array(t.result)}catch(e){r=!0}c()},void t.readAsArrayBuffer(M)}catch(n){r=!0}else try{return q=M.size,void ut.send(M)}catch(n){o=!0}else if(i)if(r)o||s();else try{M=_(M,[])}catch(n){r=!0}else try{return q=M.length,void ut.sendAsBinary(M)}catch(n){i=!0}a(c)};c(),vt(0)}else{try{"string"==typeof M?(q=T(M),ut.send(M)):(q=0,ut.send(null))}catch(n){return B(C,[24])}vt(0)}}}),S=function(){C&&C(new Error("abort"));try{ut.abort()}catch(e){}},c(S)};return s.corsResponseContentTypeOnly=!1,s.corsRequestHeaders=!1,s.corsCredentials=!1,s.cors=!1,s.corsDELETE=!1,s.corsHEAD=!1,s.corsPATCH=!1,s.corsPUT=!1,s.corsStatus=!1,s.corsResponseTextOnly=!1,s.corsFineGrainedTimeouts=!0,s.requestTextOnly=!1,s.anyMethod=!1,s.relativeURLs=!0,function(){try{n=function(e,t){return new XMLHttpRequest(t)};var r=n();if(s.requestTextOnly=!e.Uint8Array&&!r.sendAsBinary,s.cors="withCredentials"in r,s.cors)return s.corsRequestHeaders=!0,s.corsCredentials=!0,s.corsDELETE=!0,s.corsPATCH=!0,s.corsPUT=!0,s.corsHEAD=!0,void(s.corsStatus=!0)}catch(o){}try{return void(e.XDomainRequest===t?(n=function(e,t){return new XMLHttpRequest(t)})():(n=function(e,t){return e?new XDomainRequest:new XMLHttpRequest(t)},n(!0),s.cors=!0,s.corsResponseContentTypeOnly=!0,s.corsResponseTextOnly=!0,s.corsFineGrainedTimeouts=!1))}catch(o){}try{return void n()}catch(o){}for(var i=["Microsoft.XMLHTTP","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP"],u=i.length;u--;)try{return n=function(){return new ActiveXObject(i[u])},n(),void(s.requestTextOnly=!0)}catch(o){}n=t}(),s.PATCH=!!function(){try{return n().open("PATCH",location.href,!0),1}catch(e){}}(),s._hooks=g(),s.hook=m,s.anonymousOption=function(){try{return n(!0,{mozAnon:!0}).mozAnon===!0&&n(!0,{mozAnon:!1}).mozAnon===!1&&n(!1,{mozAnon:!0}).mozAnon===!0&&n(!1,{mozAnon:!1}).mozAnon===!1}catch(e){return!1}}(),s.anonymousByDefault=!1,s.systemOption=function(){try{return n(!0,{mozAnon:!0,mozSystem:!0}).mozSystem===!0&&n(!0,{mozAnon:!0,mozSystem:!1}).mozSystem===!1&&n(!1,{mozAnon:!0,mozSystem:!0}).mozSystem===!0&&n(!1,{mozAnon:!0,mozSystem:!1}).mozSystem===!1}catch(e){return!1}}(),s.systemByDefault=!1,s.forbiddenInputHeaders=["proxy-*","sec-*","accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],s};return k()});return function(e){"use strict";e("when/lib/env",["require"],function(e){function t(){return"undefined"!=typeof process&&null!==process&&"function"==typeof process.nextTick}function n(){return"function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver}function r(e){function t(){var e=n;n=void 0,e()}var n,r=document.createTextNode(""),o=new e(t);o.observe(r,{characterData:!0});var i=0;return function(e){n=e,r.data=i^=1}}var o,i="undefined"!=typeof setTimeout&&setTimeout,u=function(e,t){return setTimeout(e,t)},s=function(e){return clearTimeout(e)},a=function(e){return i(e,0)};if(t())a=function(e){return process.nextTick(e)};else if(o=n())a=r(o);else if(!i){var c=e,f=c("vertx");u=function(e,t){return f.setTimer(t,e)},s=f.cancelTimer,a=f.runOnLoop||f.runOnContext}return{setTimer:u,clearTimer:s,asap:a}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e(t)}),function(e){"use strict";e("when/lib/TimeoutError",[],function(){function e(t){Error.call(this),this.message=t,this.name=e.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/decorators/timed",["require","../env","../TimeoutError"],function(e){function t(e,t,r,o){return n.setTimer(function(){e(r,o,t)},t)}var n=e("../env"),r=e("../TimeoutError");return function(e){function o(e,n,r){t(i,e,n,r)}function i(e,t){t.resolve(e)}function u(e,t,n){var o="undefined"==typeof e?new r("timed out after "+n+"ms"):e;t.reject(o)}return e.prototype.delay=function(e){var t=this._beget();return this._handler.fold(o,e,void 0,t._handler),t},e.prototype.timeout=function(e,r){var o=this._beget(),i=o._handler,s=t(u,e,r,o._handler);return this._handler.visit(i,function(e){n.clearTimer(s),this.resolve(e)},function(e){n.clearTimer(s),this.reject(e)},i.notify),o},e}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e(t)}),function(e){"use strict";e("when/lib/state",[],function(){function e(){return{state:"pending"}}function t(e){return{state:"rejected",reason:e}}function n(e){return{state:"fulfilled",value:e}}function r(r){var o=r.state();return 0===o?e():o>0?n(r.value):t(r.value)}return{pending:e,fulfilled:n,rejected:t,inspect:r}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/apply",[],function(){function e(e,n){function r(t,r,i){var u=e._defer(),s=i.length,a=new Array(s);return o({f:t,thisArg:r,args:i,params:a,i:s-1,call:n},u._handler),u}function o(t,r){if(t.i<0)return n(t.f,t.thisArg,t.params,r);var o=e._handler(t.args[t.i]);o.fold(i,t,void 0,r)}function i(e,t,n){e.params[e.i]=t,e.i-=1,o(e,n)}return arguments.length<2&&(n=t),r}function t(e,t,n,r){try{r.resolve(e.apply(t,n))}catch(o){r.reject(o)}}return e.tryCatchResolve=t,e})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/decorators/array",["require","../state","../apply"],function(e){var t=e("../state"),n=e("../apply");return function(e){function r(t){function n(e){f=null,this.resolve(e)}function r(e){this.resolved||(f.push(e),0===--c&&this.reject(f))}for(var o,i,u=e._defer(),s=u._handler,a=t.length>>>0,c=a,f=[],l=0;a>l;++l)if(i=t[l],void 0!==i||l in t){if(o=e._handler(i),o.state()>0){s.become(o),e._visitRemaining(t,l,o);break}o.visit(s,n,r)}else--c;return 0===c&&s.reject(new RangeError("any(): array must not be empty")),u}function o(t,n){function r(e){this.resolved||(f.push(e),0===--d&&(l=null,this.resolve(f)))}function o(e){this.resolved||(l.push(e),0===--i&&(f=null,this.reject(l)))}var i,u,s,a=e._defer(),c=a._handler,f=[],l=[],p=t.length>>>0,d=0;for(s=0;p>s;++s)u=t[s],(void 0!==u||s in t)&&++d;for(n=Math.max(n,0),i=d-n+1,d=Math.min(n,d),n>d?c.reject(new RangeError("some(): array must contain at least "+n+" item(s), but had "+d)):0===d&&c.resolve(f),s=0;p>s;++s)u=t[s],(void 0!==u||s in t)&&e._handler(u).visit(c,r,o,c.notify);return a}function i(t,n){return e._traverse(n,t)}function u(t,n){var r=g.call(t);return e._traverse(n,r).then(function(e){return s(r,e)})}function s(t,n){for(var r=n.length,o=new Array(r),i=0,u=0;r>i;++i)n[i]&&(o[u++]=e._handler(t[i]).value);return o.length=u,o}function a(e){return y(e.map(c))}function c(n){var r=e._handler(n);return 0===r.state()?h(n).then(t.fulfilled,t.rejected):(r._unreport(),t.inspect(r))}function f(e,t){return arguments.length>2?v.call(e,p(t),arguments[2]):v.call(e,p(t))}function l(e,t){return arguments.length>2?m.call(e,p(t),arguments[2]):m.call(e,p(t))}function p(e){return function(t,n,r){return d(e,void 0,[t,n,r])}}var d=n(e),h=e.resolve,y=e.all,v=Array.prototype.reduce,m=Array.prototype.reduceRight,g=Array.prototype.slice;return e.any=r,e.some=o,e.settle=a,e.map=i,e.filter=u,e.reduce=f,e.reduceRight=l,e.prototype.spread=function(e){return this.then(y).then(function(t){return e.apply(this,t)})},e}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e(t)}),function(e){"use strict";e("when/lib/decorators/flow",[],function(){function e(){throw new TypeError("catch predicate must be a function")}function t(e,t){return n(t)?e instanceof t:t(e)}function n(e){return e===Error||null!=e&&e.prototype instanceof Error
}function r(e){return("object"==typeof e||"function"==typeof e)&&null!==e}function o(e){return e}return function(n){function i(e,n){return function(r){return t(r,n)?e.call(this,r):c(r)}}function u(e,t,n,o){var i=e.call(t);return r(i)?s(i,n,o):n(o)}function s(e,t,n){return a(e).then(function(){return t(n)})}var a=n.resolve,c=n.reject,f=n.prototype["catch"];return n.prototype.done=function(e,t){this._handler.visit(this._handler.receiver,e,t)},n.prototype["catch"]=n.prototype.otherwise=function(t){return arguments.length<2?f.call(this,t):"function"!=typeof t?this.ensure(e):f.call(this,i(arguments[1],t))},n.prototype["finally"]=n.prototype.ensure=function(e){return"function"!=typeof e?this:this.then(function(t){return u(e,this,o,t)},function(t){return u(e,this,c,t)})},n.prototype["else"]=n.prototype.orElse=function(e){return this.then(void 0,function(){return e})},n.prototype["yield"]=function(e){return this.then(function(){return e})},n.prototype.tap=function(e){return this.then(e)["yield"](this)},n}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/decorators/fold",[],function(){return function(e){return e.prototype.fold=function(t,n){var r=this._beget();return this._handler.fold(function(n,r,o){e._handler(n).fold(function(e,n,r){r.resolve(t.call(this,n,e))},r,this,o)},n,r._handler.receiver,r._handler),r},e}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/decorators/inspect",["require","../state"],function(e){var t=e("../state").inspect;return function(e){return e.prototype.inspect=function(){return t(e._handler(this))},e}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e(t)}),function(e){"use strict";e("when/lib/decorators/iterate",[],function(){return function(e){function t(e,t,r,o){return n(function(t){return[t,e(t)]},t,r,o)}function n(e,t,o,i){function u(i,u){return r(o(i)).then(function(){return n(e,t,o,u)})}return r(i).then(function(n){return r(t(n)).then(function(t){return t?n:r(e(n)).spread(u)})})}var r=e.resolve;return e.iterate=t,e.unfold=n,e}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/decorators/progress",[],function(){return function(e){return e.prototype.progress=function(e){return this.then(void 0,void 0,e)},e}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/decorators/with",[],function(){return function(e){return e.prototype["with"]=e.prototype.withThis=function(e){var t=this._beget(),n=t._handler;return n.receiver=e,this._handler.chain(n,e),t},e}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/format",[],function(){function e(e){var n="object"==typeof e&&null!==e&&e.stack?e.stack:t(e);return e instanceof Error?n:n+" (WARNING: non-Error used)"}function t(e){var t=String(e);return"[object Object]"===t&&"undefined"!=typeof JSON&&(t=n(e,t)),t}function n(e,t){try{return JSON.stringify(e)}catch(n){return t}}return{formatError:e,formatObject:t,tryStringify:n}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/decorators/unhandledRejection",["require","../env","../format"],function(e){function t(e){throw e}function n(){}var r=e("../env").setTimer,o=e("../format");return function(e){function i(e){e.handled||(d.push(e),f("Potentially unhandled rejection ["+e.id+"] "+o.formatError(e.value)))}function u(e){var t=d.indexOf(e);t>=0&&(d.splice(t,1),l("Handled previous rejection ["+e.id+"] "+o.formatObject(e.value)))}function s(e,t){p.push(e,t),null===h&&(h=r(a,0))}function a(){for(h=null;p.length>0;)p.shift()(p.shift())}var c,f=n,l=n;"undefined"!=typeof console&&(c=console,f="undefined"!=typeof c.error?function(e){c.error(e)}:function(e){c.log(e)},l="undefined"!=typeof c.info?function(e){c.info(e)}:function(e){c.log(e)}),e.onPotentiallyUnhandledRejection=function(e){s(i,e)},e.onPotentiallyUnhandledRejectionHandled=function(e){s(u,e)},e.onFatalRejection=function(e){s(t,e.value)};var p=[],d=[],h=null;return e}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e(t)}),function(e){"use strict";e("when/lib/makePromise",[],function(){return function(e){function t(e,t){this._handler=e===b?t:n(e)}function n(e){function t(e){o.resolve(e)}function n(e){o.reject(e)}function r(e){o.notify(e)}var o=new _;try{e(t,n,r)}catch(i){n(i)}return o}function r(e){return q(e)?e:new t(b,new T(v(e)))}function o(e){return new t(b,new T(new A(e)))}function i(){return Z}function u(){return new t(b,new _)}function s(e,t){var n=new _(e.receiver,e.join().context);return new t(b,n)}function a(e){return f(N,null,e)}function c(e,t){return f(D,e,t)}function f(e,n,r){function o(t,o,u){u.resolved||l(r,i,t,e(n,o,t),u)}function i(e,t,n){f[e]=t,0===--c&&n.become(new j(f))}for(var u,s="function"==typeof n?o:i,a=new _,c=r.length>>>0,f=new Array(c),p=0;p<r.length&&!a.resolved;++p)u=r[p],void 0!==u||p in r?l(r,s,p,u,a):--c;return 0===c&&a.become(new j(f)),new t(b,a)}function l(e,t,n,r,o){if(U(r)){var i=m(r),u=i.state();0===u?i.fold(t,n,void 0,o):u>0?t(n,i.value,o):(o.become(i),p(e,n+1,i))}else t(n,r,o)}function p(e,t,n){for(var r=t;r<e.length;++r)d(v(e[r]),n)}function d(e,t){if(e!==t){var n=e.state();0===n?e.visit(e,void 0,e._unreport):0>n&&e._unreport()}}function h(e){return"object"!=typeof e||null===e?o(new TypeError("non-iterable passed to race()")):0===e.length?i():1===e.length?r(e[0]):y(e)}function y(e){var n,r,o,i=new _;for(n=0;n<e.length;++n)if(r=e[n],void 0!==r||n in e){if(o=v(r),0!==o.state()){i.become(o),p(e,n+1,o);break}o.visit(i,i.resolve,i.reject)}return new t(b,i)}function v(e){return q(e)?e._handler.join():U(e)?g(e):new j(e)}function m(e){return q(e)?e._handler.join():g(e)}function g(e){try{var t=e.then;return"function"==typeof t?new x(t,e):new j(e)}catch(n){return new A(n)}}function b(){}function w(){}function _(e,n){t.createContext(this,n),this.consumers=void 0,this.receiver=e,this.handler=void 0,this.resolved=!1}function T(e){this.handler=e}function x(e,t){_.call(this),V.enqueue(new B(e,t,this))}function j(e){t.createContext(this),this.value=e}function A(e){t.createContext(this),this.id=++$,this.value=e,this.handled=!1,this.reported=!1,this._report()}function E(e,t){this.rejection=e,this.context=t}function C(e){this.rejection=e}function O(){return new A(new TypeError("Promise cycle"))}function k(e,t){this.continuation=e,this.handler=t}function S(e,t){this.handler=t,this.value=e}function B(e,t,n){this._then=e,this.thenable=t,this.resolver=n}function P(e,t,n,r,o){try{e.call(t,n,r,o)}catch(i){r(i)}}function R(e,t,n,r){this.f=e,this.z=t,this.c=n,this.to=r,this.resolver=W,this.receiver=this}function q(e){return e instanceof t}function U(e){return("object"==typeof e||"function"==typeof e)&&null!==e}function z(e,n,r,o){return"function"!=typeof e?o.become(n):(t.enterContext(n),F(e,n.value,r,o),void t.exitContext())}function H(e,n,r,o,i){return"function"!=typeof e?i.become(r):(t.enterContext(r),M(e,n,r.value,o,i),void t.exitContext())}function L(e,n,r,o,i){return"function"!=typeof e?i.notify(n):(t.enterContext(r),I(e,n,o,i),void t.exitContext())}function D(e,t,n){try{return e(t,n)}catch(r){return o(r)}}function F(e,t,n,r){try{r.become(v(e.call(n,t)))}catch(o){r.become(new A(o))}}function M(e,t,n,r,o){try{e.call(r,t,n,o)}catch(i){o.become(new A(i))}}function I(e,t,n,r){try{r.notify(e.call(n,t))}catch(o){r.notify(o)}}function G(e,t){t.prototype=K(e.prototype),t.prototype.constructor=t}function N(e,t){return t}function Q(){}function X(){return"undefined"!=typeof process&&null!==process&&"function"==typeof process.emit?function(e,t){return"unhandledRejection"===e?process.emit(e,t.value,t):process.emit(e,t)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(e,t,n){var r=!1;try{var o=new n("unhandledRejection");r=o instanceof n}catch(i){}return r?function(e,r){var o=new n(e,{detail:{reason:r.value,key:r},bubbles:!1,cancelable:!0});return!t.dispatchEvent(o)}:e}(Q,self,CustomEvent):Q}var V=e.scheduler,J=X(),K=Object.create||function(e){function t(){}return t.prototype=e,new t};t.resolve=r,t.reject=o,t.never=i,t._defer=u,t._handler=v,t.prototype.then=function(e,t,n){var r=this._handler,o=r.join().state();if("function"!=typeof e&&o>0||"function"!=typeof t&&0>o)return new this.constructor(b,r);var i=this._beget(),u=i._handler;return r.chain(u,r.receiver,e,t,n),i},t.prototype["catch"]=function(e){return this.then(void 0,e)},t.prototype._beget=function(){return s(this._handler,this.constructor)},t.all=a,t.race=h,t._traverse=c,t._visitRemaining=p,b.prototype.when=b.prototype.become=b.prototype.notify=b.prototype.fail=b.prototype._unreport=b.prototype._report=Q,b.prototype._state=0,b.prototype.state=function(){return this._state},b.prototype.join=function(){for(var e=this;void 0!==e.handler;)e=e.handler;return e},b.prototype.chain=function(e,t,n,r,o){this.when({resolver:e,receiver:t,fulfilled:n,rejected:r,progress:o})},b.prototype.visit=function(e,t,n,r){this.chain(W,e,t,n,r)},b.prototype.fold=function(e,t,n,r){this.when(new R(e,t,n,r))},G(b,w),w.prototype.become=function(e){e.fail()};var W=new w;G(b,_),_.prototype._state=0,_.prototype.resolve=function(e){this.become(v(e))},_.prototype.reject=function(e){this.resolved||this.become(new A(e))},_.prototype.join=function(){if(!this.resolved)return this;for(var e=this;void 0!==e.handler;)if(e=e.handler,e===this)return this.handler=O();return e},_.prototype.run=function(){var e=this.consumers,t=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var n=0;n<e.length;++n)t.when(e[n])},_.prototype.become=function(e){this.resolved||(this.resolved=!0,this.handler=e,void 0!==this.consumers&&V.enqueue(this),void 0!==this.context&&e._report(this.context))},_.prototype.when=function(e){this.resolved?V.enqueue(new k(e,this.handler)):void 0===this.consumers?this.consumers=[e]:this.consumers.push(e)},_.prototype.notify=function(e){this.resolved||V.enqueue(new S(e,this))},_.prototype.fail=function(e){var t="undefined"==typeof e?this.context:e;this.resolved&&this.handler.join().fail(t)},_.prototype._report=function(e){this.resolved&&this.handler.join()._report(e)},_.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},G(b,T),T.prototype.when=function(e){V.enqueue(new k(e,this))},T.prototype._report=function(e){this.join()._report(e)},T.prototype._unreport=function(){this.join()._unreport()},G(_,x),G(b,j),j.prototype._state=1,j.prototype.fold=function(e,t,n,r){H(e,t,this,n,r)},j.prototype.when=function(e){z(e.fulfilled,this,e.receiver,e.resolver)};var $=0;G(b,A),A.prototype._state=-1,A.prototype.fold=function(e,t,n,r){r.become(this)},A.prototype.when=function(e){"function"==typeof e.rejected&&this._unreport(),z(e.rejected,this,e.receiver,e.resolver)},A.prototype._report=function(e){V.afterQueue(new E(this,e))},A.prototype._unreport=function(){this.handled||(this.handled=!0,V.afterQueue(new C(this)))},A.prototype.fail=function(e){this.reported=!0,J("unhandledRejection",this),t.onFatalRejection(this,void 0===e?this.context:e)},E.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,J("unhandledRejection",this.rejection)||t.onPotentiallyUnhandledRejection(this.rejection,this.context))},C.prototype.run=function(){this.rejection.reported&&(J("rejectionHandled",this.rejection)||t.onPotentiallyUnhandledRejectionHandled(this.rejection))},t.createContext=t.enterContext=t.exitContext=t.onPotentiallyUnhandledRejection=t.onPotentiallyUnhandledRejectionHandled=t.onFatalRejection=Q;var Y=new b,Z=new t(b,Y);return k.prototype.run=function(){this.handler.join().when(this.continuation)},S.prototype.run=function(){var e=this.handler.consumers;if(void 0!==e)for(var t,n=0;n<e.length;++n)t=e[n],L(t.progress,this.value,this.handler,t.receiver,t.resolver)},B.prototype.run=function(){function e(e){r.resolve(e)}function t(e){r.reject(e)}function n(e){r.notify(e)}var r=this.resolver;P(this._then,this.thenable,e,t,n)},R.prototype.fulfilled=function(e){this.f.call(this.c,this.z,e,this.to)},R.prototype.rejected=function(e){this.to.reject(e)},R.prototype.progress=function(e){this.to.notify(e)},t}})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/Scheduler",[],function(){function e(e){this._async=e,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var t=this;this.drain=function(){t._drain()}}return e.prototype.enqueue=function(e){this._queue[this._queueLen++]=e,this.run()},e.prototype.afterQueue=function(e){this._afterQueue[this._afterQueueLen++]=e,this.run()},e.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},e.prototype._drain=function(){for(var e=0;e<this._queueLen;++e)this._queue[e].run(),this._queue[e]=void 0;for(this._queueLen=0,this._running=!1,e=0;e<this._afterQueueLen;++e)this._afterQueue[e].run(),this._afterQueue[e]=void 0;this._afterQueueLen=0},e})}("function"==typeof n&&n.amd?n:function(e){module.exports=e()}),function(e){"use strict";e("when/lib/Promise",["require","./makePromise","./Scheduler","./env"],function(e){var t=e("./makePromise"),n=e("./Scheduler"),r=e("./env").asap;return t({scheduler:new n(r)})})}("function"==typeof n&&n.amd?n:function(e){module.exports=e(t)}),function(e){"use strict";e("when/when",["require","./lib/decorators/timed","./lib/decorators/array","./lib/decorators/flow","./lib/decorators/fold","./lib/decorators/inspect","./lib/decorators/iterate","./lib/decorators/progress","./lib/decorators/with","./lib/decorators/unhandledRejection","./lib/TimeoutError","./lib/Promise","./lib/apply"],function(e){function t(e,t,n,r){var o=x.resolve(e);return arguments.length<2?o:o.then(t,n,r)}function n(e){return new x(e)}function r(e){return function(){for(var t=0,n=arguments.length,r=new Array(n);n>t;++t)r[t]=arguments[t];return j(e,this,r)}}function o(e){for(var t=0,n=arguments.length-1,r=new Array(n);n>t;++t)r[t]=arguments[t+1];return j(e,this,r)}function i(){return new u}function u(){function e(e){r._handler.resolve(e)}function t(e){r._handler.reject(e)}function n(e){r._handler.notify(e)}var r=x._defer();this.promise=r,this.resolve=e,this.reject=t,this.notify=n,this.resolver={resolve:e,reject:t,notify:n}}function s(e){return e&&"function"==typeof e.then}function a(){return x.all(arguments)}function c(e){return t(e,x.all)}function f(e){return t(e,x.settle)}function l(e,n){return t(e,function(e){return x.map(e,n)})}function p(e,n){return t(e,function(e){return x.filter(e,n)})}var d=e("./lib/decorators/timed"),h=e("./lib/decorators/array"),y=e("./lib/decorators/flow"),v=e("./lib/decorators/fold"),m=e("./lib/decorators/inspect"),g=e("./lib/decorators/iterate"),b=e("./lib/decorators/progress"),w=e("./lib/decorators/with"),_=e("./lib/decorators/unhandledRejection"),T=e("./lib/TimeoutError"),x=[h,y,v,g,b,m,w,d,_].reduce(function(e,t){return t(e)},e("./lib/Promise")),j=e("./lib/apply")(x);return t.promise=n,t.resolve=x.resolve,t.reject=x.reject,t.lift=r,t["try"]=o,t.attempt=o,t.iterate=x.iterate,t.unfold=x.unfold,t.join=a,t.all=c,t.settle=f,t.any=r(x.any),t.some=r(x.some),t.race=r(x.race),t.map=l,t.filter=p,t.reduce=r(x.reduce),t.reduceRight=r(x.reduceRight),t.isPromiseLike=s,t.Promise=x,t.defer=i,t.TimeoutError=T,t})}("function"==typeof n&&n.amd?n:function(e){module.exports=e(t)}),n("when",["when/when"],function(e){return e}),n("_",["httpinvoke","when"],function(e,t){function n(){this.client=null,this.interfaces=o}var r={"text json":JSON.parse,"json text":JSON.stringify},o={};return n.client=null,n.interfaces=o,n.register=function(e,t){o[e]=t},n.prototype.register=n.register,n.request=function(n,o,i){var u=this.client.baseUrl+"/"+n;i="undefined"!=typeof i?i:{},i.converters=r,i.outputType="json",i.headers="undefined"!=typeof i.headers?i.headers:{},i.headers["trakt-api-key"]=this.client.id,i.headers["trakt-api-version"]=2,"undefined"==typeof i.headers.Authorization&&null!=this.client.authorization&&null!=this.client.authorization.access_token&&(i.headers.Authorization="Bearer "+this.client.authorization.access_token);var s=t.defer();return null==i.headers["trakt-api-key"]?(s.reject("missing api key"),s.promise):(e(u,o,i).then(function(e){e.statusCode>=200&&e.statusCode<=299?s.resolve(e.body):s.reject(e.body,e.statusCode,e.headers,null,e.statusText)},function(e){s.reject(null,null,null,null,e)}),s.promise)},n.prototype.request=n.request,n.get=function(e,t){return this.request(e,"GET",t)},n.prototype.get=n.get,n.post=function(e,t){return this.request(e,"POST",t)},n.prototype.post=n.post,n.cleanParameters=function(e){for(var t in e)e.hasOwnProperty(t)&&"undefined"==typeof e[t]&&delete e[t];return e},n.prototype.cleanParameters=n.cleanParameters,n.toQueryString=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},n.prototype.toQueryString=n.toQueryString,n.getSiteUrl=function(){var e=this.client.baseUrl.split("://"),t=e[1].split(".");return t.shift(),[e[0],t.join(".")].join("://")},n.prototype.getSiteUrl=n.getSiteUrl,n}),n("interfaces/users/settings",["_"],function(e){function t(e){this._=e}t.prototype.get=function(e,t){return t="undefined"!=typeof t?t:{},"undefined"!=typeof e&&(t.headers="undefined"!=typeof t.headers?t.headers:{},t.headers.Authorization="Bearer "+e),this._.get("users/settings",t)},e.register("users/settings",t)}),n("interfaces/oauth",["_","when"],function(e,t){function n(e){this._=e}n.prototype.authorizeUrl=function(e,t){var n=this._.cleanParameters({response_type:"code",client_id:this._.client.id,redirect_uri:"undefined"!=typeof e?e:"urn:ietf:wg:oauth:2.0:oob",state:t});return null==n.client_id?(console.error('missing client "id" parameter'),null):null==n.redirect_uri?(console.error('invalid "redirect_uri" parameter provided'),null):this._.getSiteUrl()+"/oauth/authorize?"+this._.toQueryString(n)},n.prototype.token=function(e,n,r){var o=this._.cleanParameters({client_id:this._.client.id,client_secret:this._.client.secret,code:e,redirect_uri:"undefined"!=typeof n?n:"urn:ietf:wg:oauth:2.0:oob",grant_type:"undefined"!=typeof r?r:"authorization_code"});return null==o.client_id||null==o.client_secret?t.reject('missing client "id" or "secret" parameter'):null==o.code||null==o.redirect_uri||null==o.grant_type?t.reject('invalid "code", "redirect_uri" or "grant_type" parameter provided'):this._.post("oauth/token",{input:o,inputType:"json",headers:{"Content-Type":"application/json"}})},e.register("oauth",n)}),n("interfaces/scrobble",["_"],function(e){function t(e){this._=e}t.prototype.start=function(e){return this._.post("scrobble/start",{input:e,inputType:"json",headers:{"Content-Type":"application/json"}})},t.prototype.pause=function(e){return this._.post("scrobble/pause",{input:e,inputType:"json",headers:{"Content-Type":"application/json"}})},t.prototype.stop=function(e){return this._.post("scrobble/stop",{input:e,inputType:"json",headers:{"Content-Type":"application/json"}})},e.register("scrobble",t)}),n("interfaces/search",["_","when"],function(e,t){function n(e){this._=e}n.prototype.lookup=function(e,n){var r=this._.cleanParameters({id_type:e,id:n});return null==r.id_type||null==r.id?t.reject('"id_type" and "id" parameters are required'):this._.get("search?"+this._.toQueryString(r))},n.prototype.query=function(e,n,r){var o=this._.cleanParameters({query:e,type:n,year:r});return null==o.query?t.reject('"query" parameter is required'):this._.get("search?"+this._.toQueryString(o))},e.register("search",n)}),n("trakt",["_","interfaces/users/settings","interfaces/oauth","interfaces/scrobble","interfaces/search"],function(e){function t(t){for(var n in e.interfaces){if(!e.interfaces.hasOwnProperty(n))return;t.__defineGetter__(n,function(e){return function(){return new t._.interfaces[e](t._)}}(n))}}function n(n,i){this.baseUrl=r,this.version=o,this.id=n,this.secret=i,this.authorization=null,this._=new e,this._.client=this,t(this)}var r="https://api-v2launch.trakt.tv",o="1.0.0";return n._=e,n.baseUrl=r,n.version=o,n.id="574886e8a654562ba1453788c0c076adb53b78fc7425135e0db10dff01f51809",n.secret="1421a6b546de8ab27e3fe00596708ebc0051fe8fe856eedfb827ebd22b04372b",n.authorization=null,n._.client=n,t(n),{Client:n}}),t("trakt")});
//# sourceMappingURL=trakt.js
//# sourceMappingURL=trakt.js.map