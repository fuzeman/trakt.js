!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash-amd/object/merge"),require("whatwg-fetch"),require("querystring")):"function"==typeof define&&define.amd?define(["lodash-amd/object/merge","whatwg-fetch","querystring"],t):"object"==typeof exports?exports.trakt=t(require("lodash-amd/object/merge"),require("whatwg-fetch"),require("querystring")):e.trakt=t(e["lodash-amd/object/merge"],e["whatwg-fetch"],e.querystring)}(this,function(e,t,n){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)}([function(e,t,n){"use strict";function r(e){return void 0!==e&&null!==e}function i(e){return r(e)&&"[object Function]"==={}.toString.call(e)}function o(e){return r(e)&&"[object String]"==={}.toString.call(e)}function s(e,t){return r(e)?(0,u.default)({},t,e):t}Object.defineProperty(t,"__esModule",{value:!0}),t.isDefined=r,t.isFunction=i,t.isString=o,t.setDefaults=s;var u=function(e){return e&&e.__esModule?e:{default:e}}(n(2))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(0),u=function(){function e(t){r(this,e),this._client=(0,s.isDefined)(t)?t:null}return o(e,[{key:"http",get:function(){return(0,s.isDefined)(this._client)?this._client.http:null}}]),e}();t.default=u,e.exports=t.default},function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.Client=t.RefreshDisableAt=t.RefreshAt=t.Build=void 0;var u=n(0),a=r(n(5)),c=r(n(6)),f=r(n(1)),l={Version:"2.0.0-alpha.2",Date:"2016-10-01"};t.Build=l;t.RefreshAt=604800;t.RefreshDisableAt=-2419200,(0,u.isDefined)(fetch)||console.error('"fetch" is not available, include whatwg-fetch to support this environment'),(0,u.isDefined)(Promise)||console.error('"Promise" is not available, include babel-polyfill to support this environment');var p=function(){function e(t,n,r){i(this,e),r=(0,u.setDefaults)(r,{application:{name:"trakt.js",version:l.Version,date:l.Date},debug:!1,session:null,sessionKey:null,onSessionRefreshed:null}),this.key=t||null,this.secret=n||null,this.session=null,(0,u.isDefined)(r.session)?this.session=r.session:(0,u.isDefined)(r.sessionKey)&&(this.session={key:r.sessionKey}),this.onSessionRefreshed=r.onSessionRefreshed,this.application=r.application,this.build=l,this.debug=r.debug,this.http=null,this._initialized=!1,this._interfaces={},this._refreshing=Promise.resolve(),this.initialize()}return s(e,[{key:"initialize",value:function(){this._initialized||(this.http=new a.default(this),this._interfaces=this._constructInterfaces(c.default),this._initialized=!0)}},{key:"getSession",value:function(e){var t=this;return e=(0,u.setDefaults)(e,{refresh:!0}),this._refreshing.then(function(){var n=t.session;return(0,u.isDefined)(n)?((0,u.isFunction)(n)&&(n=n()),Promise.resolve(n).then(function(n){if(!(0,u.isDefined)(n))return Promise.reject(new Error("No session available"));(0,u.isDefined)(n.created_at)&&(0,u.isDefined)(n.expires_in)||console.warn("Missing session expiry properties, unable to determine session validity");var r=Math.round(n.created_at+n.expires_in-Date.now()/1e3);return r>604800?((0,u.isDefined)(t.onSessionRefreshed)||console.warn("onSessionRefreshed callback hasn't been implemented, session will expire in %d second(s)",Math.round(r)),n):r<-2419200?Promise.reject(new Error("Session expired "+Math.round(Math.abs(r))+" second(s) ago")):(0,u.isDefined)(t.onSessionRefreshed)?(r<0&&console.warn("Session expired "+Math.round(Math.abs(r))+" second(s) ago"),e.refresh?(t._refreshing=t._refreshSession(n),t._refreshing.then(function(){return t.getSession({refresh:!1})})):(console.warn("Token refresh has been disabled"),n)):r<0?Promise.reject(new Error("Session expired "+Math.round(Math.abs(r))+" second(s) ago")):(console.warn("onSessionRefreshed callback hasn't been implemented, unable to refresh session"),n)})):Promise.reject(new Error("No session available"))})}},{key:"_constructInterfaces",value:function(e){var t,n=this,r={};return Object.keys(e).forEach(function(i){t=e[i],t.prototype instanceof f.default?r[i]=new t(n):r[i]=n._constructInterfaces(t)}),r}},{key:"_refreshSession",value:function(e){var t=this;return(0,u.isDefined)(e)&&(0,u.isDefined)(e.refresh_token)?((0,u.isDefined)(e.redirect_uri)||console.warn('Session has no "redirect_uri" property, defaulting to "urn:ietf:wg:oauth:2.0:oob"'),(0,u.isDefined)(this.onSessionRefreshed)?this.oauth.refresh(e.refresh_token,e.redirect_uri).then(function(e){(0,u.isDefined)(t.onSessionRefreshed)&&t.onSessionRefreshed(e)},function(e){console.error("Unable to refresh session:",e.stack)}):Promise.reject(new Error("Unable to refresh session, onSessionRefreshed callback hasn't been implemented"))):Promise.reject(new Error('Unable to refresh session, no "refresh_token" property is available'))}},{key:"siteUrl",get:function(){var e=this.http.baseUrl.split("://"),t=e[1].split(".");return t.shift(),[e[0],t.join(".")].join("://")}},{key:"users",get:function(){return this._interfaces.users}},{key:"oauth",get:function(){return this._interfaces.oauth}},{key:"scrobble",get:function(){return this._interfaces.scrobble}},{key:"search",get:function(){return this._interfaces.search}}]),e}();t.Client=p},function(e,n){e.exports=t},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(2)),c=r(n(11)),f=n(0),l=function(){function e(t,n){o(this,e),this._client=t,this._baseUrl=n||"https://api.trakt.tv/"}return u(e,[{key:"get",value:function(e,t){return this.request("GET",e,t)}},{key:"post",value:function(e,t){return this.request("POST",e,t)}},{key:"request",value:function(e,t,n){var r=this;if(n=(0,a.default)({headers:{},params:{},body:null,bodyType:"json",authenticated:!1,session:null,application:null,includeAppParameters:!1},n||{}),(0,f.isDefined)(n.application)||(n.application=this._client.application),n.headers["trakt-api-key"]=this._client.key,n.headers["trakt-api-version"]=2,n.authenticated){if(!(0,f.isDefined)(n.session))return this._client.getSession().then(function(o){return(0,f.isDefined)(o)?r.request(e,t,i({},n,{session:o})):Promise.reject(new Error("Authentication required, but an invalid session was returned"))},function(e){return Promise.reject(new Error("Authentication required, but no session is available (error: "+e.message+")"))});if(!(0,f.isDefined)(n.session.access_token))return Promise.reject(new Error('Invalid session provided, expected an object with the "access_token" property'));n.headers.Authorization="Bearer "+n.session.access_token}if((0,f.isDefined)(n.application)||(n.application={name:"trakt.js",version:this._client.build.version,date:this._client.build.date}),!0===n.includeAppParameters){if("POST"!==e)return Promise.reject(new Error('"includeAppParameters" can only be used with POST requests'));(0,f.isDefined)(n.application.version)&&(n.body.app_version=n.application.version),(0,f.isDefined)(n.application.date)&&(n.body.app_date=n.application.date)}if(n.headers["User-Agent"]=this._buildUserAgent(n.application),(0,f.isDefined)(n.body)){if("json"!==n.bodyType)throw new Error('Invalid "bodyType" provided: "'+n.bodyType+'"');n.body=JSON.stringify(n.body),n.headers["Content-Type"]="application/json"}return this._client.debug&&console.debug("[trakt.js] %s %o (options: %O)",e,t,n),fetch(this._baseUrl+t+"?"+this.encodeParameters(n.params),{method:e,headers:n.headers,body:n.body}).then(function(e){return e.json()})}},{key:"encodeParameters",value:function(e){return Object.keys(e).forEach(function(t){void 0===e[t]&&delete e[t]}),c.default.encode(e)}},{key:"_buildUserAgent",value:function(e){var t="";(0,f.isDefined)(e.name)?t+=e.name:t+="Unknown";var n=[e.version,e.date].filter(function(e){return(0,f.isDefined)(e)});return n.length<1?t:t+" ("+n.join("; ")+")"}},{key:"baseUrl",get:function(){return this._baseUrl}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"UserSettingsInterface",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"OAuthInterface",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"ScrobbleInterface",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"SearchInterface",{enumerable:!0,get:function(){return u.default}}),t.default=void 0;var i=r(n(10)),o=r(n(7)),s=r(n(8)),u=r(n(9)),a={users:{settings:i.default},oauth:o.default,scrobble:s.default,search:u.default};t.default=a},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function a(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=n(0),l=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),p=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),u(t,[{key:"authorizeUrl",value:function(e,t){if(!(0,f.isDefined)(this._client.key))throw new Error('Missing required client "key" parameter');return this._client.siteUrl+"oauth/authorize?"+this.http.encodeParameters({client_id:this._client.key,response_type:"code",redirect_uri:(0,f.isDefined)(e)?e:"urn:ietf:wg:oauth:2.0:oob",state:t})}},{key:"exchange",value:function(e,t,n){if(!(0,f.isDefined)(this._client.key))throw new Error('Missing required client "key" parameter');if(!(0,f.isDefined)(this._client.secret))throw new Error('Missing required client "secret" parameter');if(!(0,f.isDefined)(e))throw new Error('Invalid value provided for the "code" parameter');return(0,f.isDefined)(t)||(t="urn:ietf:wg:oauth:2.0:oob"),this.http.post("oauth/token",i({},n,{body:{client_id:this._client.key,client_secret:this._client.secret,code:e,redirect_uri:t,grant_type:"authorization_code"}})).then(function(e){return(0,f.isDefined)(e)?(e.redirect_uri=t,e):e})}},{key:"refresh",value:function(e,t,n){if(!(0,f.isDefined)(this._client.key))throw new Error('Missing required client "key" parameter');if(!(0,f.isDefined)(this._client.secret))throw new Error('Missing required client "secret" parameter');if(!(0,f.isDefined)(e))throw new Error('Invalid value provided for the "code" parameter');return this.http.post("oauth/token",i({},n,{body:{client_id:this._client.key,client_secret:this._client.secret,refresh_token:e,redirect_uri:(0,f.isDefined)(t)?t:"urn:ietf:wg:oauth:2.0:oob",grant_type:"refresh_token"}}))}}]),t}(l.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function a(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),l=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),u(t,[{key:"start",value:function(e,t,n){return this.http.post("scrobble/start",i({},n,{authenticated:!0,includeAppParameters:!0,body:i({},e,{progress:t})}))}},{key:"pause",value:function(e,t,n){return this.http.post("scrobble/pause",i({},n,{authenticated:!0,includeAppParameters:!0,body:i({},e,{progress:t})}))}},{key:"stop",value:function(e,t,n){return this.http.post("scrobble/stop",i({},n,{authenticated:!0,includeAppParameters:!0,body:i({},e,{progress:t})}))}}]),t}(f.default);t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function a(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=n(0),l=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),p=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),u(t,[{key:"lookup",value:function(e,t,n){if(!(0,f.isDefined)(e))throw new Error('Invalid value provided for the "type" parameter');if(!(0,f.isDefined)(t))throw new Error('Invalid value provided for the "id" parameter');return this.http.get("search",i({},n,{params:{id_type:e,id:t}}))}},{key:"query",value:function(e,t,n,r){if(!(0,f.isDefined)(e))throw new Error('Invalid value provided for the "query" parameter');return this.http.get("search",i({},r,{params:{query:e,type:t,year:n}}))}}]),t}(l.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function a(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),l=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),u(t,[{key:"get",value:function(e){return this.http.get("users/settings",i({},e,{authenticated:!0}))}}]),t}(f.default);t.default=l,e.exports=t.default},function(e,t){e.exports=n},function(e,t,n){n(4),e.exports=n(3)}])});
//# sourceMappingURL=trakt.min.js.map