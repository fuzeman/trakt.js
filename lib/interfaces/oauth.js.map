{"version":3,"sources":["interfaces/oauth.js"],"names":["OAuthInterface","redirectUri","state","_client","key","Error","siteUrl","http","encodeParameters","code","options","secret","post","body","then","session","refreshToken"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;IAGqBA,c;;;;;;;;;;;;;iCACJC,W,EAAaC,K,EAAO;AAC7B,UAAG,CAAC,wBAAU,KAAKC,OAAL,CAAaC,GAAvB,CAAJ,EAAiC;AAC7B,cAAM,IAAIC,KAAJ,CAAU,yCAAV,CAAN;AACH;;AAED,aAAO,KAAKF,OAAL,CAAaG,OAAb,GAAuB,kBAAvB,GAA4C,KAAKC,IAAL,CAAUC,gBAAV,CAA2B;AAC1E,qBAAa,KAAKL,OAAL,CAAaC,GADgD;AAG1E,yBAAiB,MAHyD;AAI1E,wBAAgB,wBAAUH,WAAV,IAAyBA,WAAzB,GAAuC,2BAJmB;AAK1E,iBAASC;AALiE,OAA3B,CAAnD;AAOH;;;6BAEQO,I,EAAMR,W,EAAaS,O,EAAS;AACjC,UAAG,CAAC,wBAAU,KAAKP,OAAL,CAAaC,GAAvB,CAAJ,EAAiC;AAC7B,cAAM,IAAIC,KAAJ,CAAU,yCAAV,CAAN;AACH;;AAED,UAAG,CAAC,wBAAU,KAAKF,OAAL,CAAaQ,MAAvB,CAAJ,EAAoC;AAChC,cAAM,IAAIN,KAAJ,CAAU,4CAAV,CAAN;AACH;;AAED,UAAG,CAAC,wBAAUI,IAAV,CAAJ,EAAqB;AACjB,cAAM,IAAIJ,KAAJ,CAAU,iDAAV,CAAN;AACH;;AAED,UAAG,CAAC,wBAAUJ,WAAV,CAAJ,EAA4B;AACxBA,sBAAc,2BAAd;AACH;;AAED,aAAO,KAAKM,IAAL,CAAUK,IAAV,CAAe,aAAf,eACAF,OADA;AAEHG,cAAM;AACF,uBAAa,KAAKV,OAAL,CAAaC,GADxB;AAEF,2BAAiB,KAAKD,OAAL,CAAaQ,MAF5B;AAIF,kBAAQF,IAJN;AAKF,0BAAgBR,WALd;AAMF,wBAAc;AANZ;AAFH,UAUJa,IAVI,CAUC,UAACC,OAAD,EAAa;AACjB,YAAG,CAAC,wBAAUA,OAAV,CAAJ,EAAwB;AACpB,iBAAOA,OAAP;AACH;;AAEDA,gBAAQ,cAAR,IAA0Bd,WAA1B;AACA,eAAOc,OAAP;AACH,OAjBM,CAAP;AAkBH;;;4BAEOC,Y,EAAcf,W,EAAaS,O,EAAS;AACxC,UAAG,CAAC,wBAAU,KAAKP,OAAL,CAAaC,GAAvB,CAAJ,EAAiC;AAC7B,cAAM,IAAIC,KAAJ,CAAU,yCAAV,CAAN;AACH;;AAED,UAAG,CAAC,wBAAU,KAAKF,OAAL,CAAaQ,MAAvB,CAAJ,EAAoC;AAChC,cAAM,IAAIN,KAAJ,CAAU,4CAAV,CAAN;AACH;;AAED,UAAG,CAAC,wBAAUW,YAAV,CAAJ,EAA6B;AACzB,cAAM,IAAIX,KAAJ,CAAU,iDAAV,CAAN;AACH;;AAED,aAAO,KAAKE,IAAL,CAAUK,IAAV,CAAe,aAAf,eACAF,OADA;AAEHG,cAAM;AACF,uBAAa,KAAKV,OAAL,CAAaC,GADxB;AAEF,2BAAiB,KAAKD,OAAL,CAAaQ,MAF5B;AAIF,2BAAiBK,YAJf;AAKF,0BAAgB,wBAAUf,WAAV,IAAyBA,WAAzB,GAAuC,2BALrD;AAMF,wBAAc;AANZ;AAFH,SAAP;AAWH","file":"interfaces/oauth.js","sourcesContent":["import {isDefined} from '../core/helpers';\r\nimport Interface from './base';\r\n\r\n\r\nexport default class OAuthInterface extends Interface {\r\n    authorizeUrl(redirectUri, state) {\r\n        if(!isDefined(this._client.key)) {\r\n            throw new Error('Missing required client \"key\" parameter');\r\n        }\r\n\r\n        return this._client.siteUrl + 'oauth/authorize?' + this.http.encodeParameters({\r\n            'client_id': this._client.key,\r\n\r\n            'response_type': 'code',\r\n            'redirect_uri': isDefined(redirectUri) ? redirectUri : 'urn:ietf:wg:oauth:2.0:oob',\r\n            'state': state\r\n        });\r\n    }\r\n\r\n    exchange(code, redirectUri, options) {\r\n        if(!isDefined(this._client.key)) {\r\n            throw new Error('Missing required client \"key\" parameter');\r\n        }\r\n\r\n        if(!isDefined(this._client.secret)) {\r\n            throw new Error('Missing required client \"secret\" parameter');\r\n        }\r\n\r\n        if(!isDefined(code)) {\r\n            throw new Error('Invalid value provided for the \"code\" parameter');\r\n        }\r\n\r\n        if(!isDefined(redirectUri)) {\r\n            redirectUri = 'urn:ietf:wg:oauth:2.0:oob';\r\n        }\r\n\r\n        return this.http.post('oauth/token', {\r\n            ...options,\r\n            body: {\r\n                'client_id': this._client.key,\r\n                'client_secret': this._client.secret,\r\n\r\n                'code': code,\r\n                'redirect_uri': redirectUri,\r\n                'grant_type': 'authorization_code'\r\n            }\r\n        }).then((session) => {\r\n            if(!isDefined(session)) {\r\n                return session;\r\n            }\r\n\r\n            session['redirect_uri'] = redirectUri;\r\n            return session;\r\n        });\r\n    }\r\n\r\n    refresh(refreshToken, redirectUri, options) {\r\n        if(!isDefined(this._client.key)) {\r\n            throw new Error('Missing required client \"key\" parameter');\r\n        }\r\n\r\n        if(!isDefined(this._client.secret)) {\r\n            throw new Error('Missing required client \"secret\" parameter');\r\n        }\r\n\r\n        if(!isDefined(refreshToken)) {\r\n            throw new Error('Invalid value provided for the \"code\" parameter');\r\n        }\r\n\r\n        return this.http.post('oauth/token', {\r\n            ...options,\r\n            body: {\r\n                'client_id': this._client.key,\r\n                'client_secret': this._client.secret,\r\n\r\n                'refresh_token': refreshToken,\r\n                'redirect_uri': isDefined(redirectUri) ? redirectUri : 'urn:ietf:wg:oauth:2.0:oob',\r\n                'grant_type': 'refresh_token'\r\n            }\r\n        });\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}